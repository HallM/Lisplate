/*! lisplate - v0.2.0
* https://github.com/HallM/lisplate
* Copyright (c) 2016 ; Released under the MIT License */
!function(a,b){"function"==typeof define&&define.amd&&define.amd.dust===!0?define("lisplate.parser",[],b):"object"==typeof exports?module.exports=b():b()}(this,function(){var a=function(){"use strict";function a(a,b){function c(){this.constructor=a}c.prototype=b.prototype,a.prototype=new c}function b(a,c,d,e){this.message=a,this.expected=c,this.found=d,this.location=e,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,b)}function c(a){function c(){return e(Rc,Qc)}function d(b){var c,d,e=Sc[b];if(e)return e;for(c=b-1;!Sc[c];)c--;for(e=Sc[c],e={line:e.line,column:e.column,seenCR:e.seenCR};c<b;)d=a.charAt(c),"\n"===d?(e.seenCR||e.line++,e.column=1,e.seenCR=!1):"\r"===d||"\u2028"===d||"\u2029"===d?(e.line++,e.column=1,e.seenCR=!0):(e.column++,e.seenCR=!1),c++;return Sc[b]=e,e}function e(a,b){var c=d(a),e=d(b);return{start:{offset:a,line:c.line,column:c.column},end:{offset:b,line:e.line,column:e.column}}}function f(a){Qc<Tc||(Qc>Tc&&(Tc=Qc,Uc=[]),Uc.push(a))}function g(a,c,d,e){function f(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,1):b++}function g(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0100-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1000-\uFFFF]/g,function(a){return"\\u"+b(a)})}var d,e,f,g=new Array(a.length);for(f=0;f<a.length;f++)g[f]=a[f].description;return d=a.length>1?g.slice(0,-1).join(", ")+" or "+g[a.length-1]:g[0],e=b?'"'+c(b)+'"':"end of input","Expected "+d+" but "+e+" found."}return null!==c&&f(c),new b(null!==a?a:g(c,d),c,d,e)}function h(){var a;return a=i()}function i(){var a,b,c,d,e;for(a=Qc,b=[],c=Qc,d=[],e=J();e!==ca;)d.push(e),e=J();for(d!==ca?(e=U(),e===ca&&(e=E()),e!==ca?(Rc=c,d=fa(e),c=d):(Qc=c,c=ca)):(Qc=c,c=ca);c!==ca;){for(b.push(c),c=Qc,d=[],e=J();e!==ca;)d.push(e),e=J();d!==ca?(e=U(),e===ca&&(e=E()),e!==ca?(Rc=c,d=fa(e),c=d):(Qc=c,c=ca)):(Qc=c,c=ca)}if(b!==ca){for(c=[],d=J();d!==ca;)c.push(d),d=J();c!==ca?(Rc=a,b=ga(b),a=b):(Qc=a,a=ca)}else Qc=a,a=ca;return a}function j(){var b;return 10===a.charCodeAt(Qc)?(b=ha,Qc++):(b=ca,0===Vc&&f(ia)),b===ca&&(a.substr(Qc,2)===ja?(b=ja,Qc+=2):(b=ca,0===Vc&&f(ka)),b===ca&&(13===a.charCodeAt(Qc)?(b=la,Qc++):(b=ca,0===Vc&&f(ma)),b===ca&&(8232===a.charCodeAt(Qc)?(b=na,Qc++):(b=ca,0===Vc&&f(oa)),b===ca&&(8233===a.charCodeAt(Qc)?(b=pa,Qc++):(b=ca,0===Vc&&f(qa)))))),b}function k(){var b;return ra.test(a.charAt(Qc))?(b=a.charAt(Qc),Qc++):(b=ca,0===Vc&&f(sa)),b===ca&&(b=j()),b}function l(){var b;return 123===a.charCodeAt(Qc)?(b=ta,Qc++):(b=ca,0===Vc&&f(ua)),b}function m(){var b;return 125===a.charCodeAt(Qc)?(b=va,Qc++):(b=ca,0===Vc&&f(wa)),b}function n(){var b;return 40===a.charCodeAt(Qc)?(b=xa,Qc++):(b=ca,0===Vc&&f(ya)),b}function o(){var b;return 41===a.charCodeAt(Qc)?(b=za,Qc++):(b=ca,0===Vc&&f(Aa)),b}function p(){var b,c,d,e,g,h,i;if(b=Qc,34===a.charCodeAt(Qc)?(c=Ba,Qc++):(c=ca,0===Vc&&f(Ca)),c!==ca){for(d=[],e=Qc,g=Qc,Vc++,34===a.charCodeAt(Qc)?(h=Ba,Qc++):(h=ca,0===Vc&&f(Ca)),Vc--,h===ca?g=void 0:(Qc=g,g=ca),g!==ca?(h=Qc,Vc++,i=j(),Vc--,i===ca?h=void 0:(Qc=h,h=ca),h!==ca?(a.length>Qc?(i=a.charAt(Qc),Qc++):(i=ca,0===Vc&&f(Da)),i!==ca?(Rc=e,g=Ea(i),e=g):(Qc=e,e=ca)):(Qc=e,e=ca)):(Qc=e,e=ca);e!==ca;)d.push(e),e=Qc,g=Qc,Vc++,34===a.charCodeAt(Qc)?(h=Ba,Qc++):(h=ca,0===Vc&&f(Ca)),Vc--,h===ca?g=void 0:(Qc=g,g=ca),g!==ca?(h=Qc,Vc++,i=j(),Vc--,i===ca?h=void 0:(Qc=h,h=ca),h!==ca?(a.length>Qc?(i=a.charAt(Qc),Qc++):(i=ca,0===Vc&&f(Da)),i!==ca?(Rc=e,g=Ea(i),e=g):(Qc=e,e=ca)):(Qc=e,e=ca)):(Qc=e,e=ca);d!==ca?(34===a.charCodeAt(Qc)?(e=Ba,Qc++):(e=ca,0===Vc&&f(Ca)),e!==ca?(Rc=b,c=Fa(d),b=c):(Qc=b,b=ca)):(Qc=b,b=ca)}else Qc=b,b=ca;return b}function q(){var a,b;return a=Qc,b=r(),b===ca&&(b=u()),b!==ca&&(Rc=a,b=Ga(b)),a=b}function r(){var b,c,d,e;return b=Qc,c=u(),c!==ca?(46===a.charCodeAt(Qc)?(d=Ha,Qc++):(d=ca,0===Vc&&f(Ia)),d!==ca?(e=s(),e!==ca?(Rc=b,c=Ja(c,e),b=c):(Qc=b,b=ca)):(Qc=b,b=ca)):(Qc=b,b=ca),b}function s(){var b,c,d;if(b=Qc,c=[],Ka.test(a.charAt(Qc))?(d=a.charAt(Qc),Qc++):(d=ca,0===Vc&&f(La)),d!==ca)for(;d!==ca;)c.push(d),Ka.test(a.charAt(Qc))?(d=a.charAt(Qc),Qc++):(d=ca,0===Vc&&f(La));else c=ca;return c!==ca&&(Rc=b,c=Ma(c)),b=c}function t(){var b,c,d;return b=Qc,45===a.charCodeAt(Qc)?(c=Na,Qc++):(c=ca,0===Vc&&f(Oa)),c!==ca?(d=s(),d!==ca?(Rc=b,c=Pa(d),b=c):(Qc=b,b=ca)):(Qc=b,b=ca),b}function u(){var a;return a=t(),a===ca&&(a=s()),a}function v(){var b,c;return b=Qc,a.substr(Qc,4)===Qa?(c=Qa,Qc+=4):(c=ca,0===Vc&&f(Ra)),c!==ca&&(Rc=b,c=Sa()),b=c,b===ca&&(b=Qc,a.substr(Qc,5)===Ta?(c=Ta,Qc+=5):(c=ca,0===Vc&&f(Ua)),c!==ca&&(Rc=b,c=Va()),b=c),b}function w(){var a,b;return a=Qc,b=p(),b===ca&&(b=q(),b===ca&&(b=v())),b!==ca&&(Rc=a,b=Wa(b)),a=b}function x(){var b,c,d,e;if(b=Qc,Xa.test(a.charAt(Qc))?(c=a.charAt(Qc),Qc++):(c=ca,0===Vc&&f(Ya)),c!==ca){for(d=[],Za.test(a.charAt(Qc))?(e=a.charAt(Qc),Qc++):(e=ca,0===Vc&&f($a));e!==ca;)d.push(e),Za.test(a.charAt(Qc))?(e=a.charAt(Qc),Qc++):(e=ca,0===Vc&&f($a));d!==ca?(Rc=b,c=_a(c,d),b=c):(Qc=b,b=ca)}else Qc=b,b=ca;return b}function y(){var b,c,d,e,g,h;if(b=Qc,c=x(),c!==ca){for(d=[],e=Qc,46===a.charCodeAt(Qc)?(g=Ha,Qc++):(g=ca,0===Vc&&f(Ia)),g!==ca?(h=x(),h!==ca?(Rc=e,g=ab(c,h),e=g):(Qc=e,e=ca)):(Qc=e,e=ca);e!==ca;)d.push(e),e=Qc,46===a.charCodeAt(Qc)?(g=Ha,Qc++):(g=ca,0===Vc&&f(Ia)),g!==ca?(h=x(),h!==ca?(Rc=e,g=ab(c,h),e=g):(Qc=e,e=ca)):(Qc=e,e=ca);d!==ca?(Rc=b,c=bb(c,d),b=c):(Qc=b,b=ca)}else Qc=b,b=ca;return b}function z(){var b,c,d,e;if(b=Qc,cb.test(a.charAt(Qc))?(c=a.charAt(Qc),Qc++):(c=ca,0===Vc&&f(db)),c!==ca){for(d=[],eb.test(a.charAt(Qc))?(e=a.charAt(Qc),Qc++):(e=ca,0===Vc&&f(fb));e!==ca;)d.push(e),eb.test(a.charAt(Qc))?(e=a.charAt(Qc),Qc++):(e=ca,0===Vc&&f(fb));d!==ca?(Rc=b,c=_a(c,d),b=c):(Qc=b,b=ca)}else Qc=b,b=ca;return b}function A(){var b;return a.substr(Qc,2)===gb?(b=gb,Qc+=2):(b=ca,0===Vc&&f(hb)),b}function B(){var b,c,d,e;return b=Qc,c=z(),c!==ca?(d=A(),d!==ca?(46===a.charCodeAt(Qc)?(e=Ha,Qc++):(e=ca,0===Vc&&f(Ia)),e!==ca?(Rc=b,c=ib(c),b=c):(Qc=b,b=ca)):(Qc=b,b=ca)):(Qc=b,b=ca),b===ca&&(b=Qc,c=z(),c!==ca?(d=A(),d!==ca?(e=y(),e!==ca?(Rc=b,c=jb(c,e),b=c):(Qc=b,b=ca)):(Qc=b,b=ca)):(Qc=b,b=ca),b===ca&&(b=Qc,c=y(),c!==ca&&(Rc=b,c=kb(c)),b=c)),b}function C(){var a,b,c,d,e,f,g;if(a=Qc,b=n(),b!==ca)if(c=K(),c!==ca){for(d=[],e=Qc,f=y(),f!==ca?(g=K(),g!==ca?(Rc=e,f=lb(f),e=f):(Qc=e,e=ca)):(Qc=e,e=ca);e!==ca;)d.push(e),e=Qc,f=y(),f!==ca?(g=K(),g!==ca?(Rc=e,f=lb(f),e=f):(Qc=e,e=ca)):(Qc=e,e=ca);d!==ca?(e=K(),e!==ca?(f=o(),f!==ca?(Rc=a,b=mb(d),a=b):(Qc=a,a=ca)):(Qc=a,a=ca)):(Qc=a,a=ca)}else Qc=a,a=ca;else Qc=a,a=ca;return a}function D(){var a,b,c,d,e;for(a=Qc,b=[],c=Qc,d=V(),d!==ca?(e=K(),e!==ca?(Rc=c,d=nb(d),c=d):(Qc=c,c=ca)):(Qc=c,c=ca);c!==ca;)b.push(c),c=Qc,d=V(),d!==ca?(e=K(),e!==ca?(Rc=c,d=nb(d),c=d):(Qc=c,c=ca)):(Qc=c,c=ca);return b!==ca&&(Rc=a,b=mb(b)),a=b}function E(){var b,c,d,e,g,h,i,n;if(b=Qc,c=j(),c!==ca){for(d=[],e=k();e!==ca;)d.push(e),e=k();d!==ca?(Rc=b,c=ob(c,d),b=c):(Qc=b,b=ca)}else Qc=b,b=ca;if(b===ca){if(b=Qc,c=[],d=Qc,e=Qc,Vc++,g=J(),Vc--,g===ca?e=void 0:(Qc=e,e=ca),e!==ca?(g=Qc,Vc++,h=l(),Vc--,h===ca?g=void 0:(Qc=g,g=ca),g!==ca?(h=Qc,Vc++,i=m(),Vc--,i===ca?h=void 0:(Qc=h,h=ca),h!==ca?(i=Qc,Vc++,n=j(),Vc--,n===ca?i=void 0:(Qc=i,i=ca),i!==ca?(a.length>Qc?(n=a.charAt(Qc),Qc++):(n=ca,0===Vc&&f(Da)),n!==ca?(Rc=d,e=Ea(n),d=e):(Qc=d,d=ca)):(Qc=d,d=ca)):(Qc=d,d=ca)):(Qc=d,d=ca)):(Qc=d,d=ca),d!==ca)for(;d!==ca;)c.push(d),d=Qc,e=Qc,Vc++,g=J(),Vc--,g===ca?e=void 0:(Qc=e,e=ca),e!==ca?(g=Qc,Vc++,h=l(),Vc--,h===ca?g=void 0:(Qc=g,g=ca),g!==ca?(h=Qc,Vc++,i=m(),Vc--,i===ca?h=void 0:(Qc=h,h=ca),h!==ca?(i=Qc,Vc++,n=j(),Vc--,n===ca?i=void 0:(Qc=i,i=ca),i!==ca?(a.length>Qc?(n=a.charAt(Qc),Qc++):(n=ca,0===Vc&&f(Da)),n!==ca?(Rc=d,e=Ea(n),d=e):(Qc=d,d=ca)):(Qc=d,d=ca)):(Qc=d,d=ca)):(Qc=d,d=ca)):(Qc=d,d=ca);else c=ca;c!==ca&&(Rc=b,c=pb(c)),b=c}return b}function F(){var b;return a.substr(Qc,2)===qb?(b=qb,Qc+=2):(b=ca,0===Vc&&f(rb)),b===ca&&(a.substr(Qc,2)===sb?(b=sb,Qc+=2):(b=ca,0===Vc&&f(tb)),b===ca&&(115===a.charCodeAt(Qc)?(b=ub,Qc++):(b=ca,0===Vc&&f(vb)),b===ca&&(110===a.charCodeAt(Qc)?(b=wb,Qc++):(b=ca,0===Vc&&f(xb)),b===ca&&(114===a.charCodeAt(Qc)?(b=yb,Qc++):(b=ca,0===Vc&&f(zb)))))),b}function G(){var b,c,d,e,g;return b=Qc,c=l(),c!==ca?(126===a.charCodeAt(Qc)?(d=Ab,Qc++):(d=ca,0===Vc&&f(Bb)),d!==ca?(e=F(),e!==ca?(g=m(),g!==ca?(Rc=b,c=Cb(e),b=c):(Qc=b,b=ca)):(Qc=b,b=ca)):(Qc=b,b=ca)):(Qc=b,b=ca),b}function H(){var b,c,d;return b=Qc,c=l(),c!==ca?(42===a.charCodeAt(Qc)?(d=Db,Qc++):(d=ca,0===Vc&&f(Eb)),d!==ca?(c=[c,d],b=c):(Qc=b,b=ca)):(Qc=b,b=ca),b}function I(){var b,c,d;return b=Qc,42===a.charCodeAt(Qc)?(c=Db,Qc++):(c=ca,0===Vc&&f(Eb)),c!==ca?(d=m(),d!==ca?(c=[c,d],b=c):(Qc=b,b=ca)):(Qc=b,b=ca),b}function J(){var b,c,d,e,g,h;if(b=Qc,c=H(),c!==ca){for(d=[],e=Qc,g=Qc,Vc++,h=I(),Vc--,h===ca?g=void 0:(Qc=g,g=ca),g!==ca?(a.length>Qc?(h=a.charAt(Qc),Qc++):(h=ca,0===Vc&&f(Da)),h!==ca?(g=[g,h],e=g):(Qc=e,e=ca)):(Qc=e,e=ca);e!==ca;)d.push(e),e=Qc,g=Qc,Vc++,h=I(),Vc--,h===ca?g=void 0:(Qc=g,g=ca),g!==ca?(a.length>Qc?(h=a.charAt(Qc),Qc++):(h=ca,0===Vc&&f(Da)),h!==ca?(g=[g,h],e=g):(Qc=e,e=ca)):(Qc=e,e=ca);d!==ca?(e=I(),e!==ca?(c=[c,d,e],b=c):(Qc=b,b=ca)):(Qc=b,b=ca)}else Qc=b,b=ca;return b}function K(){var a,b;for(a=[],b=k(),b===ca&&(b=J());b!==ca;)a.push(b),b=k(),b===ca&&(b=J());return a}function L(){var b,c,d;return b=Qc,c=l(),c!==ca?(96===a.charCodeAt(Qc)?(d=Fb,Qc++):(d=ca,0===Vc&&f(Gb)),d!==ca?(c=[c,d],b=c):(Qc=b,b=ca)):(Qc=b,b=ca),b}function M(){var b,c,d;return b=Qc,96===a.charCodeAt(Qc)?(c=Fb,Qc++):(c=ca,0===Vc&&f(Gb)),c!==ca?(d=m(),d!==ca?(c=[c,d],b=c):(Qc=b,b=ca)):(Qc=b,b=ca),b}function N(){var b,c,d,e,g,h;if(b=Qc,c=L(),c!==ca){for(d=[],e=Qc,g=Qc,Vc++,h=M(),Vc--,h===ca?g=void 0:(Qc=g,g=ca),g!==ca?(a.length>Qc?(h=a.charAt(Qc),Qc++):(h=ca,0===Vc&&f(Da)),h!==ca?(Rc=e,g=Ea(h),e=g):(Qc=e,e=ca)):(Qc=e,e=ca);e!==ca;)d.push(e),e=Qc,g=Qc,Vc++,h=M(),Vc--,h===ca?g=void 0:(Qc=g,g=ca),g!==ca?(a.length>Qc?(h=a.charAt(Qc),Qc++):(h=ca,0===Vc&&f(Da)),h!==ca?(Rc=e,g=Ea(h),e=g):(Qc=e,e=ca)):(Qc=e,e=ca);d!==ca?(e=M(),e!==ca?(Rc=b,c=Hb(d),b=c):(Qc=b,b=ca)):(Qc=b,b=ca)}else Qc=b,b=ca;return b}function O(){var b,c,d,e,g,h,j,k,n;return b=Qc,c=l(),c!==ca?(d=K(),d!==ca?(a.substr(Qc,2)===Ib?(e=Ib,Qc+=2):(e=ca,0===Vc&&f(Jb)),e!==ca?(g=K(),g!==ca?(h=Qc,j=C(),j!==ca?(k=K(),k!==ca?(Rc=h,j=Kb(j),h=j):(Qc=h,h=ca)):(Qc=h,h=ca),h===ca&&(h=null),h!==ca?(j=i(),j!==ca?(k=K(),k!==ca?(n=m(),n!==ca?(Rc=b,c=Lb(h,j),b=c):(Qc=b,b=ca)):(Qc=b,b=ca)):(Qc=b,b=ca)):(Qc=b,b=ca)):(Qc=b,b=ca)):(Qc=b,b=ca)):(Qc=b,b=ca)):(Qc=b,b=ca),b}function P(){var b,c,d,e,g,h,i,j,k;return b=Qc,c=l(),c!==ca?(d=K(),d!==ca?(33===a.charCodeAt(Qc)?(e=Mb,Qc++):(e=ca,0===Vc&&f(Nb)),e===ca&&(e=null),e!==ca?(g=Z(),g!==ca?(h=K(),h!==ca?(i=D(),i!==ca?(j=K(),j!==ca?(k=m(),k!==ca?(Rc=b,c=Ob(e,g,i),b=c):(Qc=b,b=ca)):(Qc=b,b=ca)):(Qc=b,b=ca)):(Qc=b,b=ca)):(Qc=b,b=ca)):(Qc=b,b=ca)):(Qc=b,b=ca)):(Qc=b,b=ca),b}function Q(){var b,c,d,e,g;return b=Qc,58===a.charCodeAt(Qc)?(c=Pb,Qc++):(c=ca,0===Vc&&f(Qb)),c!==ca?(d=y(),d!==ca?(e=K(),e!==ca?(g=V(),g!==ca?(Rc=b,c=Rb(d,g),b=c):(Qc=b,b=ca)):(Qc=b,b=ca)):(Qc=b,b=ca)):(Qc=b,b=ca),b}function R(){var b,c,d,e,g,h,i;if(b=Qc,c=n(),c!==ca?(58===a.charCodeAt(Qc)?(d=Pb,Qc++):(d=ca,0===Vc&&f(Qb)),d!==ca?(e=o(),e!==ca?(Rc=b,c=Sb(),b=c):(Qc=b,b=ca)):(Qc=b,b=ca)):(Qc=b,b=ca),b===ca)if(b=Qc,c=n(),c!==ca)if(d=K(),d!==ca){if(e=[],g=Qc,h=Q(),h!==ca?(i=K(),i!==ca?(Rc=g,h=nb(h),g=h):(Qc=g,g=ca)):(Qc=g,g=ca),g!==ca)for(;g!==ca;)e.push(g),g=Qc,h=Q(),h!==ca?(i=K(),i!==ca?(Rc=g,h=nb(h),g=h):(Qc=g,g=ca)):(Qc=g,g=ca);else e=ca;e!==ca?(g=K(),g!==ca?(h=o(),h!==ca?(Rc=b,c=Tb(e),b=c):(Qc=b,b=ca)):(Qc=b,b=ca)):(Qc=b,b=ca)}else Qc=b,b=ca;else Qc=b,b=ca;return b}function S(){var a,b,c,d,e,f,g;if(a=Qc,b=n(),b!==ca?(c=o(),c!==ca?(Rc=a,b=Ub(),a=b):(Qc=a,a=ca)):(Qc=a,a=ca),a===ca)if(a=Qc,b=n(),b!==ca)if(c=K(),c!==ca){if(d=[],e=Qc,f=V(),f!==ca?(g=K(),g!==ca?(Rc=e,f=nb(f),e=f):(Qc=e,e=ca)):(Qc=e,e=ca),e!==ca)for(;e!==ca;)d.push(e),e=Qc,f=V(),f!==ca?(g=K(),g!==ca?(Rc=e,f=nb(f),e=f):(Qc=e,e=ca)):(Qc=e,e=ca);else d=ca;d!==ca?(e=K(),e!==ca?(f=o(),f!==ca?(Rc=a,b=Vb(d),a=b):(Qc=a,a=ca)):(Qc=a,a=ca)):(Qc=a,a=ca)}else Qc=a,a=ca;else Qc=a,a=ca;return a}function T(){var a,b,c;return a=Qc,b=l(),b!==ca?(c=m(),c!==ca?(Rc=a,b=Wb(),a=b):(Qc=a,a=ca)):(Qc=a,a=ca),a}function U(){var a;return a=O(),a===ca&&(a=P(),a===ca&&(a=N(),a===ca&&(a=G(),a===ca&&(a=T())))),a}function V(){var a;return a=U(),a===ca&&(a=w(),a===ca&&(a=R(),a===ca&&(a=S(),a===ca&&(a=B())))),a}function W(){var b,c;return b=Qc,a.substr(Qc,7)===Xb?(c=Xb,Qc+=7):(c=ca,0===Vc&&f(Yb)),c===ca&&(a.substr(Qc,4)===Zb?(c=Zb,Qc+=4):(c=ca,0===Vc&&f($b)),c===ca&&(a.substr(Qc,2)===_b?(c=_b,Qc+=2):(c=ca,0===Vc&&f(ac)),c===ca&&(a.substr(Qc,7)===bc?(c=bc,Qc+=7):(c=ca,0===Vc&&f(cc)),c===ca&&(a.substr(Qc,10)===dc?(c=dc,Qc+=10):(c=ca,0===Vc&&f(ec)))))),c!==ca&&(Rc=b,c=fc(c)),b=c}function X(){var b,c,d;return b=Qc,c=Qc,a.substr(Qc,2)===gc?(d=gc,Qc+=2):(d=ca,0===Vc&&f(hc)),d!==ca&&(Rc=c,d=ic()),c=d,c===ca&&(c=Qc,a.substr(Qc,2)===jc?(d=jc,Qc+=2):(d=ca,0===Vc&&f(kc)),d!==ca&&(Rc=c,d=lc()),c=d,c===ca&&(c=Qc,a.substr(Qc,2)===mc?(d=mc,Qc+=2):(d=ca,0===Vc&&f(nc)),d!==ca&&(Rc=c,d=oc()),c=d,c===ca&&(c=Qc,60===a.charCodeAt(Qc)?(d=pc,Qc++):(d=ca,0===Vc&&f(qc)),d!==ca&&(Rc=c,d=rc()),c=d,c===ca&&(c=Qc,62===a.charCodeAt(Qc)?(d=sc,Qc++):(d=ca,0===Vc&&f(tc)),d!==ca&&(Rc=c,d=uc()),c=d,c===ca&&(c=Qc,a.substr(Qc,3)===vc?(d=vc,Qc+=3):(d=ca,0===Vc&&f(wc)),d!==ca&&(Rc=c,d=xc()),c=d,c===ca&&(c=Qc,a.substr(Qc,2)===yc?(d=yc,Qc+=2):(d=ca,0===Vc&&f(zc)),d!==ca&&(Rc=c,d=Ac()),c=d,c===ca&&(c=Qc,a.substr(Qc,3)===Bc?(d=Bc,Qc+=3):(d=ca,0===Vc&&f(Cc)),d!==ca&&(Rc=c,d=Dc()),c=d))))))),c!==ca&&(Rc=b,c=Ec(c)),b=c}function Y(){var b,c,d;return b=Qc,c=Qc,43===a.charCodeAt(Qc)?(d=Fc,Qc++):(d=ca,0===Vc&&f(Gc)),d!==ca&&(Rc=c,d=Hc()),c=d,c===ca&&(c=Qc,45===a.charCodeAt(Qc)?(d=Na,Qc++):(d=ca,0===Vc&&f(Oa)),d!==ca&&(Rc=c,d=Ic()),c=d,c===ca&&(c=Qc,42===a.charCodeAt(Qc)?(d=Db,Qc++):(d=ca,0===Vc&&f(Eb)),d!==ca&&(Rc=c,d=Jc()),c=d,c===ca&&(c=Qc,47===a.charCodeAt(Qc)?(d=Kc,Qc++):(d=ca,0===Vc&&f(Lc)),d!==ca&&(Rc=c,d=Mc()),c=d,c===ca&&(c=Qc,37===a.charCodeAt(Qc)?(d=Nc,Qc++):(d=ca,0===Vc&&f(Oc)),d!==ca&&(Rc=c,d=Pc()),c=d)))),c!==ca&&(Rc=b,c=Ec(c)),b=c}function Z(){var a;return a=O(),a===ca&&(a=X(),a===ca&&(a=Y(),a===ca&&(a=W(),a===ca&&(a=B())))),a}function $(a){return parseInt(a.join(""),10)}function _(a){var b=c().start;return a.concat([b.line,b.column])}var aa,ba=arguments.length>1?arguments[1]:{},ca={},da={start:h},ea=h,fa=function(a){return a},ga=function(a){return["block",a]},ha="\n",ia={type:"literal",value:"\n",description:'"\\n"'},ja="\r\n",ka={type:"literal",value:"\r\n",description:'"\\r\\n"'},la="\r",ma={type:"literal",value:"\r",description:'"\\r"'},na="\u2028",oa={type:"literal",value:"\u2028",description:'"\\u2028"'},pa="\u2029",qa={type:"literal",value:"\u2029",description:'"\\u2029"'},ra=/^[\t\x0B\f \xA0\uFEFF]/,sa={type:"class",value:"[\\t\\v\\f \\u00A0\\uFEFF]",description:"[\\t\\v\\f \\u00A0\\uFEFF]"},ta="{",ua={type:"literal",value:"{",description:'"{"'},va="}",wa={type:"literal",value:"}",description:'"}"'},xa="(",ya={type:"literal",value:"(",description:'"("'},za=")",Aa={type:"literal",value:")",description:'")"'},Ba='"',Ca={type:"literal",value:'"',description:'"\\""'},Da={type:"any",description:"any character"},Ea=function(a){return a},Fa=function(a){return'"'+a.join("")+'"'},Ga=function(a){return a},Ha=".",Ia={type:"literal",value:".",description:'"."'},Ja=function(a,b){return parseFloat(a+"."+b)},Ka=/^[0-9]/,La={type:"class",value:"[0-9]",description:"[0-9]"},Ma=function(a){return $(a)},Na="-",Oa={type:"literal",value:"-",description:'"-"'},Pa=function(a){return a*-1},Qa="true",Ra={type:"literal",value:"true",description:'"true"'},Sa=function(){return!0},Ta="false",Ua={type:"literal",value:"false",description:'"false"'},Va=function(){return!1},Wa=function(a){return["literal",[a]]},Xa=/^[a-zA-Z$_]/,Ya={type:"class",value:"[a-zA-Z$_]",description:"[a-zA-Z$_]"},Za=/^[a-zA-Z0-9$_]/,$a={type:"class",value:"[a-zA-Z0-9$_]",description:"[a-zA-Z0-9$_]"},_a=function(a,b){return a+b.join("")},ab=function(a,b){return b},bb=function(a,b){return b?[a].concat(b).join("."):a},cb=/^[a-zA-Z]/,db={type:"class",value:"[a-zA-Z]",description:"[a-zA-Z]"},eb=/^[a-zA-Z0-9_]/,fb={type:"class",value:"[a-zA-Z0-9_]",description:"[a-zA-Z0-9_]"},gb="::",hb={type:"literal",value:"::",description:'"::"'},ib=function(a){return["identifier",[a,null]]},jb=function(a,b){return["identifier",[a,b]]},kb=function(a){return["identifier",["",a]]},lb=function(a){return a},mb=function(a){return a},nb=function(a){return a},ob=function(a,b){return["format",["\\n"+b.join("")]]},pb=function(a){return["buffer",[a.join("")]]},qb="rb",rb={type:"literal",value:"rb",description:'"rb"'},sb="lb",tb={type:"literal",value:"lb",description:'"lb"'},ub="s",vb={type:"literal",value:"s",description:'"s"'},wb="n",xb={type:"literal",value:"n",description:'"n"'},yb="r",zb={type:"literal",value:"r",description:'"r"'},Ab="~",Bb={type:"literal",value:"~",description:'"~"'},Cb=function(a){return["escape",[a]]},Db="*",Eb={type:"literal",value:"*",description:'"*"'},Fb="`",Gb={type:"literal",value:"`",description:'"`"'},Hb=function(a){return _(["raw",[a.join("")]])},Ib="fn",Jb={type:"literal",value:"fn",description:'"fn"'},Kb=function(a){return a},Lb=function(a,b){return _(["fn",[a,b]])},Mb="!",Nb={type:"literal",value:"!",description:'"!"'},Ob=function(a,b,c){return _(["call",[b,c,!!a]])},Pb=":",Qb={type:"literal",value:":",description:'":"'},Rb=function(a,b){return[a,b]},Sb=function(){return["map",[]]},Tb=function(a){return["map",[a]]},Ub=function(){return["array",[]]},Vb=function(a){return["array",[a]]},Wb=function(){return["empty",[]]},Xb="include",Yb={type:"literal",value:"include",description:'"include"'},Zb="each",$b={type:"literal",value:"each",description:'"each"'},_b="if",ac={type:"literal",value:"if",description:'"if"'},bc="isEmpty",cc={type:"literal",value:"isEmpty",description:'"isEmpty"'},dc="isNotEmpty",ec={type:"literal",value:"isNotEmpty",description:'"isNotEmpty"'},fc=function(a){return["internal",[a]]},gc="==",hc={type:"literal",value:"==",description:'"=="'},ic=function(){return"eq"},jc="<=",kc={type:"literal",value:"<=",description:'"<="'},lc=function(){return"lte"},mc=">=",nc={type:"literal",value:">=",description:'">="'},oc=function(){return"gte"},pc="<",qc={type:"literal",value:"<",description:'"<"'},rc=function(){return"lt"},sc=">",tc={type:"literal",value:">",description:'">"'},uc=function(){return"gt"},vc="and",wc={type:"literal",value:"and",description:'"and"'},xc=function(){return"cmpand"},yc="or",zc={type:"literal",value:"or",description:'"or"'},Ac=function(){return"cmpor"},Bc="not",Cc={type:"literal",value:"not",description:'"not"'},Dc=function(){return"not"},Ec=function(a){return["internal",[a]]},Fc="+",Gc={type:"literal",value:"+",description:'"+"'},Hc=function(){return"add"},Ic=function(){return"sub"},Jc=function(){return"mul"},Kc="/",Lc={type:"literal",value:"/",description:'"/"'},Mc=function(){return"div"},Nc="%",Oc={type:"literal",value:"%",description:'"%"'},Pc=function(){return"mod"},Qc=0,Rc=0,Sc=[{line:1,column:1,seenCR:!1}],Tc=0,Uc=[],Vc=0;if("startRule"in ba){if(!(ba.startRule in da))throw new Error("Can't start parsing from rule \""+ba.startRule+'".');ea=da[ba.startRule]}if(aa=ea(),aa!==ca&&Qc===a.length)return aa;throw aa!==ca&&Qc<a.length&&f({type:"end",description:"end of input"}),g(null,Uc,Tc<a.length?a.charAt(Tc):null,Tc<a.length?e(Tc,Tc+1):e(Tc,Tc))}return a(b,Error),{SyntaxError:b,parse:c}}();return a}),function(a,b){"function"==typeof define&&define.amd&&define.amd.dust===!0?define("lisplate.compiler",["lisplate.parser"],b):"object"==typeof exports?module.exports=b(require("./parser")):a.lisplateCompiler=b(a.lisplateParser)}(this,function(a){"use strict";function b(a,b,c,d){var e=a?a[3]:0,f=a?a[4]:0;return new p(b,c,d,{start:{offset:0,line:e,column:f},end:{offset:0,line:e,column:f}})}function c(a,b){return"$c."+a+"("+b+")\n"}function d(a){var b="",d=a.length,f="";return a.forEach(function(g,h){var i=g[0];if(i)if("format"===i||"buffer"===i){f+="format"===i?"":g[1];var j=h+1;j<d&&("format"===a[j][0]||"buffer"===a[j][0])||f.length&&(b+=c("w",'"'+f.replace(/"/g,'\\"')+'"'),f="")}else b+=c("w",e(g));else b+=""}),b}function e(a){var c=a[0];try{if("fn"===c)return l(a[1]);if("call"===c)return m(a[1]);if("raw"===c)return n(a[1]);if("escape"===c)return o(a[1]);if("identifier"===c)return g(a[1]);if("literal"===c)return h(a[1]);if("map"===c)return i(a[1]);if("array"===c)return j(a[1]);if("empty"===c)return k();throw b(null,"Expected to find an expression type but did not find one","type","null")}catch(d){throw b(a,d.message,d.expected,d.found)}}function f(a){var b=a[0];return q.indexOf(b)===-1&&q.push(b),"$i_"+a[0]}function g(a){var b=a[0],c=a[1];return b?c?"$"+b+"."+c:"$"+b:c}function h(a){return a[0]}function i(a){var b=a[0],c="{";return b&&b.length&&(c+=b.map(function(a){return a[0]+":"+e(a[1])}).join(",")),c+="}"}function j(a){var b=a[0],c="[";return b&&b.length&&(c+=b.map(function(a){return e(a)}).join(",")),c+="]"}function k(){return"null"}function l(a){var c=a[0],e=a[1],f="(function(";if(c&&c.length&&(f+=c.map(function(a){return a}).join(",")),f+=") {\nvar $c = new $_w();\n",!e||"block"!==e[0]||!e[1])throw b(null,"Expected function to contain a block","block",e?e[0]:"null");return f+=d(e[1]),f+="\n return $c.getOutput();\n})\n"}function m(a){var c=!0,d=null,h=a[0][0];if("fn"===h)c=!1,d=l(a[0][1]);else if("identifier"===h)d=g(a[0][1]);else{if("internal"!==h)throw b(null,"Unknown callable","fn, identifier, or internal",h);c=!1,d="include"===a[0][1][0]?"$$Lisplate.renderTemplate":f(a[0][1])}var i=a[1];a[2]&&(c=!1);var j=d;return c&&(j=f(["escapeHtml"])+"("+j),i&&i.length&&(j+="(",j+=i.map(function(a){return e(a)}).join(","),j+=")"),c&&(j+=")"),j}function n(a){return'"'+a[0]+'"'}function o(a){var b=a[0];if("s"===b)return'" "';if("n"===b)return'"\\n"';if("r"===b)return'"\\r"';if("lb"===b)return'"{"';if("rb"===b)return'"}"';throw new Error("Unknown escape: "+b)}var p=a.SyntaxError,q=[];return function(b,c){try{var e=a.parse(c);if("block"!==e[0])throw new p("Expected template to start with a block, but found "+e[0]+" instead","block",e[0],{start:{offset:0,line:0,column:0},end:{offset:0,line:0,column:0}});var f=d(e[1]),g=q.length?"var "+q.map(function(a){return"$i_"+a+"= $runtime."+a}).join(",\n")+";\n\n":"",h="function($$vmc){return function($$Lisplate,$data,$strings,$runtime) {var $viewmodel=$$vmc?new $$vmc($data):null; var $helper=$$Lisplate.helpers; var $_w=$runtime.$W;\nvar $c = new $_w();\n"+g+f+"\nreturn $c.getOutput();\n}\n}";return h}catch(i){if(!i.location)throw i;var j=i.message+" ["+b+":"+i.location.start.line+":"+i.location.start.column+"]";throw new p(j,i.expected,i.found,i.location)}}}),function(a,b){"function"==typeof define&&define.amd&&define.amd.dust===!0?define("lisplate.utils",[],b):"object"==typeof exports?module.exports=b():a.lisplateUtils=b()}(this,function(){"use strict";return{resolve:function(a){return"function"==typeof a?a():a},thenable:function(a){return"object"==typeof a&&"function"==typeof a.then}}}),function(a,b){"function"==typeof define&&define.amd&&define.amd.dust===!0?define("lisplate.runtime",["lisplate.utils"],b):"object"==typeof exports?module.exports=b(require("./util")):a.lisplateRuntime=b(a.lisplateUtils)}(this,function(a){"use strict";function b(a){return h[a]}function c(){this.current="",this.stack=[],this.lastFlushedIndex=0,this.thenables=[],this.isAsync=!1,this.lastWasAsync=!1}var d=a.resolve,e=a.thenable,f=/[&<>\"\']/,g=/[&<>\"\']/g,h={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"},i={escapeHtml:function(a){return"string"!=typeof a?a:f.test(a)?a.replace(g,b):a},not:function(a){return!d(a)},eq:function(a,b){return d(a)===d(b)},lt:function(a,b){return d(a)<d(b)},gt:function(a,b){return d(a)>d(b)},lte:function(a,b){return d(a)<=d(b)},gte:function(a,b){return d(a)>=d(b)},cmpand:function(a,b){return d(a)&&d(b)},cmpor:function(a,b){return d(a)||d(b)},add:function(a,b){return d(a)+d(b)},sub:function(a,b){return d(a)-d(b)},mul:function(a,b){return d(a)*d(b)},div:function(a,b){return d(a)/d(b)},mod:function(a,b){return d(a)%d(b)},each:function(a,b,f){var g=d(a);if(e(g))return g.then(function(a){return i.each(a,b,f)});var h=0;if(g&&(h=g.length)){if(b){for(var j=new c,k=0;k<h;k++)"function"==typeof b?j.w(b(g[k],k)):j.w(b);return j.getOutput()}}else if(f)return d(f);return""},"if":function(a,b,c){var f=d(a);if(e(f))return f.then(function(a){return i["if"](a,b,c)});if(f){if(b)return d(b)}else if(c)return d(c);return""},isEmpty:function(a){var b=d(a);return 0!==b&&(!(!Array.isArray(b)||b.length)||!b)},isNotEmpty:function(a){return!i.isEmpty(a)}};return c.prototype.w=function(a){var b=d(a);if(null!=b)if(e(b)){this.current.length&&(this.stack.push(this.current),this.current=""),this.isAsync=!0,this.lastWasAsync=!0;var c=this.stack.length;this.stack.push("");var f=this,g=b.then(function(a){f.stack[c]=a});this.thenables.push(g)}else this.lastWasAsync?this.current=b:this.current+=b,this.lastWasAsync=!1},c.prototype.getOutput=function(){var a=this;return a.isAsync?(a.current.length&&a.stack.push(a.current),Promise.all(a.thenables).then(function(){return a.stack.join("")})):a.current},i.$W=c,i}),function(a,b){"function"==typeof define&&define.amd&&define.amd.dust===!0?define("lisplate.core",["lisplate.compiler","lisplate.runtime","lisplate.utils"],b):"object"==typeof exports?module.exports=b(require("./compiler"),require("./runtime"),require("./util")):a.Lisplate=b(a.lisplateCompiler,a.lisplateRuntime,a.lisplateUtils)}(this,function(compiler,runtime,utils){"use strict";function _callbackify(a){var b=a.length;return function(){var c=arguments.length,d=c>b?arguments[c-1]:null,e=null;"function"==typeof d?e=Array.prototype.slice.call(arguments,0,c-1):(e=Array.prototype.slice.call(arguments,0,c),d=null);var f=a.apply(this,e);return _thenable(f)?d?void f.then(function(a){d(null,a)})["catch"](function(a){d(a)}):f:d?void d(null,f):f}}function _promisifyPossibleAsync(a){if(!a)return a;var b=a.length;return function(){var c=Array.prototype.slice.apply(arguments),d=c.length;return b===d+1?new Promise(function(b,d){c.push(function(a,c){return a?void d(a):void b(c)}),a.apply(null,c)}):Promise.resolve(a.apply(null,c))}}function Lisplate(a){a||(a={}),this.cacheEnabled=!(a.cacheEnabled===!1),this.sourceLoader=_promisifyPossibleAsync(a.sourceLoader),this.viewModelLoader=_promisifyPossibleAsync(a.viewModelLoader),this.stringsLoader=_promisifyPossibleAsync(a.stringsLoader),this.helpers={},this.cache={}}var _thenable=utils.thenable;return Lisplate.prototype.addHelper=function(a,b){this.helpers[a]=b},Lisplate.prototype.loadTemplate=_callbackify(function(a){var b=this;return a?"function"==typeof a?Promise.resolve(a):b.cache[a]?Promise.resolve(b.cache[a]):b.sourceLoader?b.sourceLoader(a).then(function(c){return b.compileFn(a,c)}):Promise.reject(new Error("Must define a sourceLoader")):Promise.reject(new Error("Must specify a template to load"))}),Lisplate.prototype.compileFn=_callbackify(function(a,b){var c=this,d=null,e=null;try{d=c.compile(a,b),e=c.loadCompiledSource(d)}catch(f){return Promise.reject(f)}var g=null;return g=c.viewModelLoader?c.viewModelLoader(a):Promise.resolve(null),g.then(function(b){var d=e(b);return d.templateName=a,c.cache[a]=d,d})}),Lisplate.prototype.compile=compiler,Lisplate.prototype.loadCompiledSource=function loadCompiledSource(compiledSource){var template=null;return eval("template="+compiledSource),template},Lisplate.prototype.render=_callbackify(function(a,b){var c=this;return c.stringsLoader?c.stringsLoader(a.templateName).then(function(d){return a(c,b,d,runtime)}):a(c,b,null,runtime)}),Lisplate.prototype.renderTemplate=_callbackify(function(a,b){var c=this;return c.loadTemplate(a).then(function(a){return c.render(a,b)})}),Lisplate});
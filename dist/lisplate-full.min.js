/*! lisplate - v0.4.0
* https://github.com/HallM/lisplate
* Copyright (c) 2016 ; Released under the MIT License */
!function(a,b){"function"==typeof define&&define.amd?define("lisplate.utils",[],b):"object"==typeof exports?module.exports=b():(a.Lisplate={},a.Lisplate.Utils=b())}(this,function(){"use strict";return{loadCompiledSource:function loadCompiledSource(compiledSource){var template=null;return eval("template="+compiledSource),template},resolve:function(a){return"function"==typeof a?a():a},thenable:function(a){return("object"==typeof a||"function"==typeof a)&&"function"==typeof a.then}}}),function(a,b){"function"==typeof define&&define.amd?define("lisplate.runtime",["lisplate.utils"],b):"object"==typeof exports?module.exports=b(require("./util")):a.Lisplate.Runtime=b(a.Lisplate.Utils)}(this,function(a){"use strict";function b(a){return j[a]}function c(a){return m[a]}function d(a){return p[a]}function e(){this.current="",this.stack=[],this.lastFlushedIndex=0,this.thenables=[],this.isAsync=!1,this.lastWasAsync=!1}var f=a.resolve,g=a.thenable,h=/[&<>\"\']/,i=/[&<>\"\']/g,j={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"},k=/[\\\/\r\n\f\t'"\u2028\u2029]/,l=/[\\\/\r\n\f\t'"\u2028\u2029]/g,m={"\\":"\\\\","/":"\\/","\r":"\\r","\n":"\\n","\f":"\\f","\t":"\\t","'":"\\'",'"':'\\"',"\u2028":"\\u2028","\u2029":"\\u2029"},n=/["<\u2028\u2029]/,o=/["<\u2028\u2029]/g,p={'"':'\\"',"<":"\\u003c","\u2028":"\\u2029","\u2029":"\\u2029"},q={escapeHtml:function(a){return"string"!=typeof a?a:h.test(a)?a.replace(i,b):a},escapeJs:function(a){return"string"!=typeof a?a:k.test(a)?a.replace(l,c):a},escapeJson:function(a){return"string"!=typeof a?a:n.test(a)?a.replace(o,d):a},not:function(a){return!f(a)},eq:function(a,b){return f(a)===f(b)},neq:function(a,b){return f(a)!==f(b)},lt:function(a,b){return f(a)<f(b)},gt:function(a,b){return f(a)>f(b)},lte:function(a,b){return f(a)<=f(b)},gte:function(a,b){return f(a)>=f(b)},cmpand:function(a,b){return f(a)&&f(b)},cmpor:function(a,b){return f(a)||f(b)},add:function(a,b){return f(a)+f(b)},sub:function(a,b){return f(a)-f(b)},mul:function(a,b){return f(a)*f(b)},div:function(a,b){return f(a)/f(b)},mod:function(a,b){return f(a)%f(b)},safe:function(a){var b=new e;return b.w(a),b},each:function(a,b,c){var d=f(a);if(g(d))return d.then(function(a){return q.each(a,b,c)});var h=0;if(d&&(h=d.length)){if(b){for(var i=new e,j=0;j<h;j++)"function"==typeof b?i.w(b(d[j],j)):i.w(b);return i.getOutput()}}else if(c)return f(c);return""},"if":function(a,b,c){var d=f(a);if(g(d))return d.then(function(a){return q["if"](a,b,c)});if(d){if(b)return f(b)}else if(c)return f(c);return""},isEmpty:function(a){var b=f(a);return 0!==b&&(!(!Array.isArray(b)||b.length)||!b)},isNotEmpty:function(a){return!q.isEmpty(a)}};return e.prototype.w=function(a){var b=f(a);if(null!=b)if(b instanceof e&&(b=b.getOutput()),g(b)){this.current.length&&(this.stack.push(this.current),this.current=""),this.isAsync=!0,this.lastWasAsync=!0;var c=this.stack.length;this.stack.push("");var d=this,h=b.then(function(a){d.stack[c]=a});this.thenables.push(h)}else this.lastWasAsync?this.current=b:this.current+=b,this.lastWasAsync=!1},e.prototype.getOutput=function(){var a=this;return a.isAsync?(a.current.length&&a.stack.push(a.current),Promise.all(a.thenables).then(function(){return a.stack.join("")})):a.current},q.Chunk=e,q}),function(a,b){"function"==typeof define&&define.amd?define("lisplate.core",["lisplate.runtime","lisplate.utils"],b):"object"==typeof exports?module.exports=b(require("./runtime"),require("./util")):a.Lisplate=b(a.Lisplate.Runtime,a.Lisplate.Utils)}(this,function(a,b){"use strict";function c(a){var b=a.length;return function(){var c=arguments.length,d=c>b?arguments[c-1]:null,f=null;"function"==typeof d?f=Array.prototype.slice.call(arguments,0,c-1):(f=Array.prototype.slice.call(arguments,0,c),d=null);var g=a.apply(this,f);return e(g)?d?void g.then(function(a){d(null,a)})["catch"](function(a){d(a)}):g:d?void d(null,g):g}}function d(a){if(!a)return a;var b=a.length;return function(){var c=Array.prototype.slice.apply(arguments),d=c.length;return b===d+1?new Promise(function(b,d){c.push(function(a,c){return a?void d(a):void b(c)}),a.apply(null,c)}):Promise.resolve(a.apply(null,c))}}function Lisplate(a){a||(a={}),this.cacheEnabled=!(a.cacheEnabled===!1),this.sourceLoader=d(a.sourceLoader),this.viewModelLoader=d(a.viewModelLoader),this.stringsLoader=d(a.stringsLoader),this.helpers={},this.cache={}}var e=b.thenable;return Lisplate.Runtime=a,Lisplate.Utils=b,Lisplate.prototype.addHelper=function(a,b){this.helpers[a]=b},Lisplate.prototype.loadTemplate=c(function(a){var b=this;if(!a)return Promise.reject(new Error("Must specify template information to load"));var c="string"==typeof a?a:a.templateName,d=a.renderFactory;if(""===c)return Promise.reject(new Error("Must specify a valid template name to load"));if(d)d=Promise.resolve(d);else{if(b.cache[c])return Promise.resolve(b.cache[c]);if(!b.sourceLoader)return Promise.reject(new Error("Must define a sourceLoader"));if(!Lisplate.Compiler||!Lisplate.Compiler.compile)return Promise.reject("Compiler is not loaded to compile loaded source");d=b.sourceLoader(c).then(function(a){var b=null,d=null;try{b=Lisplate.Compiler.compile(c,a),d=Lisplate.Utils.loadCompiledSource(b)}catch(e){return Promise.reject(e)}return Promise.resolve(d)})}return d.then(function(a){var d=null;return d=b.viewModelLoader?b.viewModelLoader(c):Promise.resolve(null),d.then(function(d){var e=a(b,d);return e.templateName=c,b.cache[c]=e,e})})}),Lisplate.prototype.render=c(function(a,b){var c=this;return c.stringsLoader?c.stringsLoader(a.templateName).then(function(c){return a(b,c,Lisplate.Runtime)}):a(b,null,Lisplate.Runtime)}),Lisplate.prototype.renderTemplate=c(function(a,b){var c=this;return c.loadTemplate(a).then(function(a){return c.render(a,b)})}),Lisplate}),function(a,b){"function"==typeof define&&define.amd?define("lisplate.parser",["lisplate.core"],b):"object"==typeof exports?module.exports=b(require("./")):b(a.Lisplate)}(this,function(Lisplate){var a=function(){"use strict";function a(a,b){function c(){this.constructor=a}c.prototype=b.prototype,a.prototype=new c}function b(a,c,d,e){this.message=a,this.expected=c,this.found=d,this.location=e,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,b)}function c(a){function c(){return e(Gc,Fc)}function d(b){var c,d,e=Hc[b];if(e)return e;for(c=b-1;!Hc[c];)c--;for(e=Hc[c],e={line:e.line,column:e.column,seenCR:e.seenCR};c<b;)d=a.charAt(c),"\n"===d?(e.seenCR||e.line++,e.column=1,e.seenCR=!1):"\r"===d||"\u2028"===d||"\u2029"===d?(e.line++,e.column=1,e.seenCR=!0):(e.column++,e.seenCR=!1),c++;return Hc[b]=e,e}function e(a,b){var c=d(a),e=d(b);return{start:{offset:a,line:c.line,column:c.column},end:{offset:b,line:e.line,column:e.column}}}function f(a){Fc<Ic||(Fc>Ic&&(Ic=Fc,Jc=[]),Jc.push(a))}function g(a,c,d,e){function f(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,1):b++}function g(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0100-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1000-\uFFFF]/g,function(a){return"\\u"+b(a)})}var d,e,f,g=new Array(a.length);for(f=0;f<a.length;f++)g[f]=a[f].description;return d=a.length>1?g.slice(0,-1).join(", ")+" or "+g[a.length-1]:g[0],e=b?'"'+c(b)+'"':"end of input","Expected "+d+" but "+e+" found."}return null!==c&&f(c),new b(null!==a?a:g(c,d),c,d,e)}function h(){var a;return a=i()}function i(){var a,b,c,d,e;for(a=Fc,b=[],c=Fc,d=[],e=J();e!==ba;)d.push(e),e=J();for(d!==ba?(e=U(),e===ba&&(e=E()),e!==ba?(Gc=c,d=ea(e),c=d):(Fc=c,c=ba)):(Fc=c,c=ba);c!==ba;){for(b.push(c),c=Fc,d=[],e=J();e!==ba;)d.push(e),e=J();d!==ba?(e=U(),e===ba&&(e=E()),e!==ba?(Gc=c,d=ea(e),c=d):(Fc=c,c=ba)):(Fc=c,c=ba)}if(b!==ba){for(c=[],d=J();d!==ba;)c.push(d),d=J();c!==ba?(Gc=a,b=fa(b),a=b):(Fc=a,a=ba)}else Fc=a,a=ba;return a}function j(){var b;return 10===a.charCodeAt(Fc)?(b=ga,Fc++):(b=ba,0===Kc&&f(ha)),b===ba&&(a.substr(Fc,2)===ia?(b=ia,Fc+=2):(b=ba,0===Kc&&f(ja)),b===ba&&(13===a.charCodeAt(Fc)?(b=ka,Fc++):(b=ba,0===Kc&&f(la)),b===ba&&(8232===a.charCodeAt(Fc)?(b=ma,Fc++):(b=ba,0===Kc&&f(na)),b===ba&&(8233===a.charCodeAt(Fc)?(b=oa,Fc++):(b=ba,0===Kc&&f(pa)))))),b}function k(){var b;return qa.test(a.charAt(Fc))?(b=a.charAt(Fc),Fc++):(b=ba,0===Kc&&f(ra)),b===ba&&(b=j()),b}function l(){var b;return 123===a.charCodeAt(Fc)?(b=sa,Fc++):(b=ba,0===Kc&&f(ta)),b}function m(){var b;return 125===a.charCodeAt(Fc)?(b=ua,Fc++):(b=ba,0===Kc&&f(va)),b}function n(){var b;return 40===a.charCodeAt(Fc)?(b=wa,Fc++):(b=ba,0===Kc&&f(xa)),b}function o(){var b;return 41===a.charCodeAt(Fc)?(b=ya,Fc++):(b=ba,0===Kc&&f(za)),b}function p(){var b,c,d,e,g,h,i;if(b=Fc,34===a.charCodeAt(Fc)?(c=Aa,Fc++):(c=ba,0===Kc&&f(Ba)),c!==ba){for(d=[],e=Fc,g=Fc,Kc++,34===a.charCodeAt(Fc)?(h=Aa,Fc++):(h=ba,0===Kc&&f(Ba)),Kc--,h===ba?g=void 0:(Fc=g,g=ba),g!==ba?(h=Fc,Kc++,i=j(),Kc--,i===ba?h=void 0:(Fc=h,h=ba),h!==ba?(a.length>Fc?(i=a.charAt(Fc),Fc++):(i=ba,0===Kc&&f(Ca)),i!==ba?(Gc=e,g=Da(i),e=g):(Fc=e,e=ba)):(Fc=e,e=ba)):(Fc=e,e=ba);e!==ba;)d.push(e),e=Fc,g=Fc,Kc++,34===a.charCodeAt(Fc)?(h=Aa,Fc++):(h=ba,0===Kc&&f(Ba)),Kc--,h===ba?g=void 0:(Fc=g,g=ba),g!==ba?(h=Fc,Kc++,i=j(),Kc--,i===ba?h=void 0:(Fc=h,h=ba),h!==ba?(a.length>Fc?(i=a.charAt(Fc),Fc++):(i=ba,0===Kc&&f(Ca)),i!==ba?(Gc=e,g=Da(i),e=g):(Fc=e,e=ba)):(Fc=e,e=ba)):(Fc=e,e=ba);d!==ba?(34===a.charCodeAt(Fc)?(e=Aa,Fc++):(e=ba,0===Kc&&f(Ba)),e!==ba?(Gc=b,c=Ea(d),b=c):(Fc=b,b=ba)):(Fc=b,b=ba)}else Fc=b,b=ba;return b}function q(){var a,b;return a=Fc,b=r(),b===ba&&(b=u()),b!==ba&&(Gc=a,b=Fa(b)),a=b}function r(){var b,c,d,e;return b=Fc,c=u(),c!==ba?(46===a.charCodeAt(Fc)?(d=Ga,Fc++):(d=ba,0===Kc&&f(Ha)),d!==ba?(e=s(),e!==ba?(Gc=b,c=Ia(c,e),b=c):(Fc=b,b=ba)):(Fc=b,b=ba)):(Fc=b,b=ba),b}function s(){var b,c,d;if(b=Fc,c=[],Ja.test(a.charAt(Fc))?(d=a.charAt(Fc),Fc++):(d=ba,0===Kc&&f(Ka)),d!==ba)for(;d!==ba;)c.push(d),Ja.test(a.charAt(Fc))?(d=a.charAt(Fc),Fc++):(d=ba,0===Kc&&f(Ka));else c=ba;return c!==ba&&(Gc=b,c=La(c)),b=c}function t(){var b,c,d;return b=Fc,45===a.charCodeAt(Fc)?(c=Ma,Fc++):(c=ba,0===Kc&&f(Na)),c!==ba?(d=s(),d!==ba?(Gc=b,c=Oa(d),b=c):(Fc=b,b=ba)):(Fc=b,b=ba),b}function u(){var a;return a=t(),a===ba&&(a=s()),a}function v(){var b,c;return b=Fc,a.substr(Fc,4)===Pa?(c=Pa,Fc+=4):(c=ba,0===Kc&&f(Qa)),c!==ba&&(Gc=b,c=Ra()),b=c,b===ba&&(b=Fc,a.substr(Fc,5)===Sa?(c=Sa,Fc+=5):(c=ba,0===Kc&&f(Ta)),c!==ba&&(Gc=b,c=Ua()),b=c),b}function w(){var a,b;return a=Fc,b=p(),b===ba&&(b=q(),b===ba&&(b=v())),b!==ba&&(Gc=a,b=Va(b)),a=b}function x(){var b,c,d,e;if(b=Fc,Wa.test(a.charAt(Fc))?(c=a.charAt(Fc),Fc++):(c=ba,0===Kc&&f(Xa)),c!==ba){for(d=[],Ya.test(a.charAt(Fc))?(e=a.charAt(Fc),Fc++):(e=ba,0===Kc&&f(Za));e!==ba;)d.push(e),Ya.test(a.charAt(Fc))?(e=a.charAt(Fc),Fc++):(e=ba,0===Kc&&f(Za));d!==ba?(Gc=b,c=$a(c,d),b=c):(Fc=b,b=ba)}else Fc=b,b=ba;return b}function y(){var b,c,d,e,g,h;if(b=Fc,c=x(),c!==ba){for(d=[],e=Fc,46===a.charCodeAt(Fc)?(g=Ga,Fc++):(g=ba,0===Kc&&f(Ha)),g!==ba?(h=x(),h!==ba?(Gc=e,g=_a(c,h),e=g):(Fc=e,e=ba)):(Fc=e,e=ba);e!==ba;)d.push(e),e=Fc,46===a.charCodeAt(Fc)?(g=Ga,Fc++):(g=ba,0===Kc&&f(Ha)),g!==ba?(h=x(),h!==ba?(Gc=e,g=_a(c,h),e=g):(Fc=e,e=ba)):(Fc=e,e=ba);d!==ba?(Gc=b,c=ab(c,d),b=c):(Fc=b,b=ba)}else Fc=b,b=ba;return b}function z(){var b,c,d,e;if(b=Fc,bb.test(a.charAt(Fc))?(c=a.charAt(Fc),Fc++):(c=ba,0===Kc&&f(cb)),c!==ba){for(d=[],db.test(a.charAt(Fc))?(e=a.charAt(Fc),Fc++):(e=ba,0===Kc&&f(eb));e!==ba;)d.push(e),db.test(a.charAt(Fc))?(e=a.charAt(Fc),Fc++):(e=ba,0===Kc&&f(eb));d!==ba?(Gc=b,c=$a(c,d),b=c):(Fc=b,b=ba)}else Fc=b,b=ba;return b}function A(){var b;return a.substr(Fc,2)===fb?(b=fb,Fc+=2):(b=ba,0===Kc&&f(gb)),b}function B(){var b,c,d,e;return b=Fc,c=z(),c!==ba?(d=A(),d!==ba?(46===a.charCodeAt(Fc)?(e=Ga,Fc++):(e=ba,0===Kc&&f(Ha)),e!==ba?(Gc=b,c=hb(c),b=c):(Fc=b,b=ba)):(Fc=b,b=ba)):(Fc=b,b=ba),b===ba&&(b=Fc,c=z(),c!==ba?(d=A(),d!==ba?(e=y(),e!==ba?(Gc=b,c=ib(c,e),b=c):(Fc=b,b=ba)):(Fc=b,b=ba)):(Fc=b,b=ba),b===ba&&(b=Fc,c=y(),c!==ba&&(Gc=b,c=jb(c)),b=c)),b}function C(){var a,b,c,d,e,f,g;if(a=Fc,b=n(),b!==ba)if(c=K(),c!==ba){for(d=[],e=Fc,f=y(),f!==ba?(g=K(),g!==ba?(Gc=e,f=kb(f),e=f):(Fc=e,e=ba)):(Fc=e,e=ba);e!==ba;)d.push(e),e=Fc,f=y(),f!==ba?(g=K(),g!==ba?(Gc=e,f=kb(f),e=f):(Fc=e,e=ba)):(Fc=e,e=ba);d!==ba?(e=K(),e!==ba?(f=o(),f!==ba?(Gc=a,b=lb(d),a=b):(Fc=a,a=ba)):(Fc=a,a=ba)):(Fc=a,a=ba)}else Fc=a,a=ba;else Fc=a,a=ba;return a}function D(){var a,b,c,d,e;for(a=Fc,b=[],c=Fc,d=V(),d!==ba?(e=K(),e!==ba?(Gc=c,d=mb(d),c=d):(Fc=c,c=ba)):(Fc=c,c=ba);c!==ba;)b.push(c),c=Fc,d=V(),d!==ba?(e=K(),e!==ba?(Gc=c,d=mb(d),c=d):(Fc=c,c=ba)):(Fc=c,c=ba);return b!==ba&&(Gc=a,b=lb(b)),a=b}function E(){var b,c,d,e,g,h,i,n;if(b=Fc,c=j(),c!==ba){for(d=[],e=k();e!==ba;)d.push(e),e=k();d!==ba?(Gc=b,c=nb(c,d),b=c):(Fc=b,b=ba)}else Fc=b,b=ba;if(b===ba){if(b=Fc,c=[],d=Fc,e=Fc,Kc++,g=J(),Kc--,g===ba?e=void 0:(Fc=e,e=ba),e!==ba?(g=Fc,Kc++,h=l(),Kc--,h===ba?g=void 0:(Fc=g,g=ba),g!==ba?(h=Fc,Kc++,i=m(),Kc--,i===ba?h=void 0:(Fc=h,h=ba),h!==ba?(i=Fc,Kc++,n=j(),Kc--,n===ba?i=void 0:(Fc=i,i=ba),i!==ba?(a.length>Fc?(n=a.charAt(Fc),Fc++):(n=ba,0===Kc&&f(Ca)),n!==ba?(Gc=d,e=Da(n),d=e):(Fc=d,d=ba)):(Fc=d,d=ba)):(Fc=d,d=ba)):(Fc=d,d=ba)):(Fc=d,d=ba),d!==ba)for(;d!==ba;)c.push(d),d=Fc,e=Fc,Kc++,g=J(),Kc--,g===ba?e=void 0:(Fc=e,e=ba),e!==ba?(g=Fc,Kc++,h=l(),Kc--,h===ba?g=void 0:(Fc=g,g=ba),g!==ba?(h=Fc,Kc++,i=m(),Kc--,i===ba?h=void 0:(Fc=h,h=ba),h!==ba?(i=Fc,Kc++,n=j(),Kc--,n===ba?i=void 0:(Fc=i,i=ba),i!==ba?(a.length>Fc?(n=a.charAt(Fc),Fc++):(n=ba,0===Kc&&f(Ca)),n!==ba?(Gc=d,e=Da(n),d=e):(Fc=d,d=ba)):(Fc=d,d=ba)):(Fc=d,d=ba)):(Fc=d,d=ba)):(Fc=d,d=ba);else c=ba;c!==ba&&(Gc=b,c=ob(c)),b=c}return b}function F(){var b;return a.substr(Fc,2)===pb?(b=pb,Fc+=2):(b=ba,0===Kc&&f(qb)),b===ba&&(a.substr(Fc,2)===rb?(b=rb,Fc+=2):(b=ba,0===Kc&&f(sb)),b===ba&&(115===a.charCodeAt(Fc)?(b=tb,Fc++):(b=ba,0===Kc&&f(ub)),b===ba&&(110===a.charCodeAt(Fc)?(b=vb,Fc++):(b=ba,0===Kc&&f(wb)),b===ba&&(114===a.charCodeAt(Fc)?(b=xb,Fc++):(b=ba,0===Kc&&f(yb)))))),b}function G(){var b,c,d,e,g;return b=Fc,c=l(),c!==ba?(126===a.charCodeAt(Fc)?(d=zb,Fc++):(d=ba,0===Kc&&f(Ab)),d!==ba?(e=F(),e!==ba?(g=m(),g!==ba?(Gc=b,c=Bb(e),b=c):(Fc=b,b=ba)):(Fc=b,b=ba)):(Fc=b,b=ba)):(Fc=b,b=ba),b}function H(){var b,c,d;return b=Fc,c=l(),c!==ba?(42===a.charCodeAt(Fc)?(d=Cb,Fc++):(d=ba,0===Kc&&f(Db)),d!==ba?(c=[c,d],b=c):(Fc=b,b=ba)):(Fc=b,b=ba),b}function I(){var b,c,d;return b=Fc,42===a.charCodeAt(Fc)?(c=Cb,Fc++):(c=ba,0===Kc&&f(Db)),c!==ba?(d=m(),d!==ba?(c=[c,d],b=c):(Fc=b,b=ba)):(Fc=b,b=ba),b}function J(){var b,c,d,e,g,h;if(b=Fc,c=H(),c!==ba){for(d=[],e=Fc,g=Fc,Kc++,h=I(),Kc--,h===ba?g=void 0:(Fc=g,g=ba),g!==ba?(a.length>Fc?(h=a.charAt(Fc),Fc++):(h=ba,0===Kc&&f(Ca)),h!==ba?(g=[g,h],e=g):(Fc=e,e=ba)):(Fc=e,e=ba);e!==ba;)d.push(e),e=Fc,g=Fc,Kc++,h=I(),Kc--,h===ba?g=void 0:(Fc=g,g=ba),g!==ba?(a.length>Fc?(h=a.charAt(Fc),Fc++):(h=ba,0===Kc&&f(Ca)),h!==ba?(g=[g,h],e=g):(Fc=e,e=ba)):(Fc=e,e=ba);d!==ba?(e=I(),e!==ba?(c=[c,d,e],b=c):(Fc=b,b=ba)):(Fc=b,b=ba)}else Fc=b,b=ba;return b}function K(){var a,b;for(a=[],b=k(),b===ba&&(b=J());b!==ba;)a.push(b),b=k(),b===ba&&(b=J());return a}function L(){var b,c,d;return b=Fc,c=l(),c!==ba?(96===a.charCodeAt(Fc)?(d=Eb,Fc++):(d=ba,0===Kc&&f(Fb)),d!==ba?(c=[c,d],b=c):(Fc=b,b=ba)):(Fc=b,b=ba),b}function M(){var b,c,d;return b=Fc,96===a.charCodeAt(Fc)?(c=Eb,Fc++):(c=ba,0===Kc&&f(Fb)),c!==ba?(d=m(),d!==ba?(c=[c,d],b=c):(Fc=b,b=ba)):(Fc=b,b=ba),b}function N(){var b,c,d,e,g,h;if(b=Fc,c=L(),c!==ba){for(d=[],e=Fc,g=Fc,Kc++,h=M(),Kc--,h===ba?g=void 0:(Fc=g,g=ba),g!==ba?(a.length>Fc?(h=a.charAt(Fc),Fc++):(h=ba,0===Kc&&f(Ca)),h!==ba?(Gc=e,g=Da(h),e=g):(Fc=e,e=ba)):(Fc=e,e=ba);e!==ba;)d.push(e),e=Fc,g=Fc,Kc++,h=M(),Kc--,h===ba?g=void 0:(Fc=g,g=ba),g!==ba?(a.length>Fc?(h=a.charAt(Fc),Fc++):(h=ba,0===Kc&&f(Ca)),h!==ba?(Gc=e,g=Da(h),e=g):(Fc=e,e=ba)):(Fc=e,e=ba);d!==ba?(e=M(),e!==ba?(Gc=b,c=Gb(d),b=c):(Fc=b,b=ba)):(Fc=b,b=ba)}else Fc=b,b=ba;return b}function O(){var b,c,d,e,g,h,j,k,n;return b=Fc,c=l(),c!==ba?(d=K(),d!==ba?(a.substr(Fc,2)===Hb?(e=Hb,Fc+=2):(e=ba,0===Kc&&f(Ib)),e!==ba?(g=K(),g!==ba?(h=Fc,j=C(),j!==ba?(k=K(),k!==ba?(Gc=h,j=Jb(j),h=j):(Fc=h,h=ba)):(Fc=h,h=ba),h===ba&&(h=null),h!==ba?(j=i(),j!==ba?(k=K(),k!==ba?(n=m(),n!==ba?(Gc=b,c=Kb(h,j),b=c):(Fc=b,b=ba)):(Fc=b,b=ba)):(Fc=b,b=ba)):(Fc=b,b=ba)):(Fc=b,b=ba)):(Fc=b,b=ba)):(Fc=b,b=ba)):(Fc=b,b=ba),b}function P(){var a,b,c,d,e,f,g,h;return a=Fc,b=l(),b!==ba?(c=K(),c!==ba?(d=Y(),d!==ba?(e=K(),e!==ba?(f=D(),f!==ba?(g=K(),g!==ba?(h=m(),h!==ba?(Gc=a,b=Lb(d,f),a=b):(Fc=a,a=ba)):(Fc=a,a=ba)):(Fc=a,a=ba)):(Fc=a,a=ba)):(Fc=a,a=ba)):(Fc=a,a=ba)):(Fc=a,a=ba),a}function Q(){var b,c,d,e,g;return b=Fc,58===a.charCodeAt(Fc)?(c=Mb,Fc++):(c=ba,0===Kc&&f(Nb)),c!==ba?(d=y(),d!==ba?(e=K(),e!==ba?(g=V(),g!==ba?(Gc=b,c=Ob(d,g),b=c):(Fc=b,b=ba)):(Fc=b,b=ba)):(Fc=b,b=ba)):(Fc=b,b=ba),b}function R(){var b,c,d,e,g,h,i;if(b=Fc,c=n(),c!==ba?(58===a.charCodeAt(Fc)?(d=Mb,Fc++):(d=ba,0===Kc&&f(Nb)),d!==ba?(e=o(),e!==ba?(Gc=b,c=Pb(),b=c):(Fc=b,b=ba)):(Fc=b,b=ba)):(Fc=b,b=ba),b===ba)if(b=Fc,c=n(),c!==ba)if(d=K(),d!==ba){if(e=[],g=Fc,h=Q(),h!==ba?(i=K(),i!==ba?(Gc=g,h=mb(h),g=h):(Fc=g,g=ba)):(Fc=g,g=ba),g!==ba)for(;g!==ba;)e.push(g),g=Fc,h=Q(),h!==ba?(i=K(),i!==ba?(Gc=g,h=mb(h),g=h):(Fc=g,g=ba)):(Fc=g,g=ba);else e=ba;e!==ba?(g=K(),g!==ba?(h=o(),h!==ba?(Gc=b,c=Qb(e),b=c):(Fc=b,b=ba)):(Fc=b,b=ba)):(Fc=b,b=ba)}else Fc=b,b=ba;else Fc=b,b=ba;return b}function S(){var a,b,c,d,e,f,g;if(a=Fc,b=n(),b!==ba?(c=o(),c!==ba?(Gc=a,b=Rb(),a=b):(Fc=a,a=ba)):(Fc=a,a=ba),a===ba)if(a=Fc,b=n(),b!==ba)if(c=K(),c!==ba){if(d=[],e=Fc,f=V(),f!==ba?(g=K(),g!==ba?(Gc=e,f=mb(f),e=f):(Fc=e,e=ba)):(Fc=e,e=ba),e!==ba)for(;e!==ba;)d.push(e),e=Fc,f=V(),f!==ba?(g=K(),g!==ba?(Gc=e,f=mb(f),e=f):(Fc=e,e=ba)):(Fc=e,e=ba);else d=ba;d!==ba?(e=K(),e!==ba?(f=o(),f!==ba?(Gc=a,b=Sb(d),a=b):(Fc=a,a=ba)):(Fc=a,a=ba)):(Fc=a,a=ba)}else Fc=a,a=ba;else Fc=a,a=ba;return a}function T(){var a,b,c;return a=Fc,b=l(),b!==ba?(c=m(),c!==ba?(Gc=a,b=Tb(),a=b):(Fc=a,a=ba)):(Fc=a,a=ba),a}function U(){var a;return a=O(),a===ba&&(a=P(),a===ba&&(a=N(),a===ba&&(a=G(),a===ba&&(a=T())))),a}function V(){var a;return a=U(),a===ba&&(a=w(),a===ba&&(a=R(),a===ba&&(a=S(),a===ba&&(a=B())))),a}function W(){var b,c,d;return b=Fc,c=Fc,a.substr(Fc,2)===Ub?(d=Ub,Fc+=2):(d=ba,0===Kc&&f(Vb)),d!==ba&&(Gc=c,d=Wb()),c=d,c===ba&&(c=Fc,a.substr(Fc,2)===Xb?(d=Xb,Fc+=2):(d=ba,0===Kc&&f(Yb)),d!==ba&&(Gc=c,d=Zb()),c=d,c===ba&&(c=Fc,a.substr(Fc,2)===$b?(d=$b,Fc+=2):(d=ba,0===Kc&&f(_b)),d!==ba&&(Gc=c,d=ac()),c=d,c===ba&&(c=Fc,a.substr(Fc,2)===bc?(d=bc,Fc+=2):(d=ba,0===Kc&&f(cc)),d!==ba&&(Gc=c,d=dc()),c=d,c===ba&&(c=Fc,60===a.charCodeAt(Fc)?(d=ec,Fc++):(d=ba,0===Kc&&f(fc)),d!==ba&&(Gc=c,d=gc()),c=d,c===ba&&(c=Fc,62===a.charCodeAt(Fc)?(d=hc,Fc++):(d=ba,0===Kc&&f(ic)),d!==ba&&(Gc=c,d=jc()),c=d,c===ba&&(c=Fc,a.substr(Fc,3)===kc?(d=kc,Fc+=3):(d=ba,0===Kc&&f(lc)),d!==ba&&(Gc=c,d=mc()),c=d,c===ba&&(c=Fc,a.substr(Fc,2)===nc?(d=nc,Fc+=2):(d=ba,0===Kc&&f(oc)),d!==ba&&(Gc=c,d=pc()),c=d,c===ba&&(c=Fc,a.substr(Fc,3)===qc?(d=qc,Fc+=3):(d=ba,0===Kc&&f(rc)),d!==ba&&(Gc=c,d=sc()),c=d)))))))),c!==ba&&(Gc=b,c=tc(c)),b=c}function X(){var b,c,d;return b=Fc,c=Fc,43===a.charCodeAt(Fc)?(d=uc,Fc++):(d=ba,0===Kc&&f(vc)),d!==ba&&(Gc=c,d=wc()),c=d,c===ba&&(c=Fc,45===a.charCodeAt(Fc)?(d=Ma,Fc++):(d=ba,0===Kc&&f(Na)),d!==ba&&(Gc=c,d=xc()),c=d,c===ba&&(c=Fc,42===a.charCodeAt(Fc)?(d=Cb,Fc++):(d=ba,0===Kc&&f(Db)),d!==ba&&(Gc=c,d=yc()),c=d,c===ba&&(c=Fc,47===a.charCodeAt(Fc)?(d=zc,Fc++):(d=ba,0===Kc&&f(Ac)),d!==ba&&(Gc=c,d=Bc()),c=d,c===ba&&(c=Fc,37===a.charCodeAt(Fc)?(d=Cc,Fc++):(d=ba,0===Kc&&f(Dc)),d!==ba&&(Gc=c,d=Ec()),c=d)))),c!==ba&&(Gc=b,c=tc(c)),b=c}function Y(){var a;return a=O(),a===ba&&(a=W(),a===ba&&(a=X(),a===ba&&(a=B()))),a}function Z(a){return parseInt(a.join(""),10)}function $(a){var b=c().start;return a.concat([b.line,b.column])}var _,aa=arguments.length>1?arguments[1]:{},ba={},ca={start:h},da=h,ea=function(a){return a},fa=function(a){return["block",a]},ga="\n",ha={type:"literal",value:"\n",description:'"\\n"'},ia="\r\n",ja={type:"literal",value:"\r\n",description:'"\\r\\n"'},ka="\r",la={type:"literal",value:"\r",description:'"\\r"'},ma="\u2028",na={type:"literal",value:"\u2028",description:'"\\u2028"'},oa="\u2029",pa={type:"literal",value:"\u2029",description:'"\\u2029"'},qa=/^[\t\x0B\f \xA0\uFEFF]/,ra={type:"class",value:"[\\t\\v\\f \\u00A0\\uFEFF]",description:"[\\t\\v\\f \\u00A0\\uFEFF]"},sa="{",ta={type:"literal",value:"{",description:'"{"'},ua="}",va={type:"literal",value:"}",description:'"}"'},wa="(",xa={type:"literal",value:"(",description:'"("'},ya=")",za={type:"literal",value:")",description:'")"'},Aa='"',Ba={type:"literal",value:'"',description:'"\\""'},Ca={type:"any",description:"any character"},Da=function(a){return a},Ea=function(a){return'"'+a.join("")+'"'},Fa=function(a){return a},Ga=".",Ha={type:"literal",value:".",description:'"."'},Ia=function(a,b){return parseFloat(a+"."+b)},Ja=/^[0-9]/,Ka={type:"class",value:"[0-9]",description:"[0-9]"},La=function(a){return Z(a)},Ma="-",Na={type:"literal",value:"-",description:'"-"'},Oa=function(a){return a*-1},Pa="true",Qa={type:"literal",value:"true",description:'"true"'},Ra=function(){return!0},Sa="false",Ta={type:"literal",value:"false",description:'"false"'},Ua=function(){return!1},Va=function(a){return["literal",[a]]},Wa=/^[a-zA-Z$_]/,Xa={type:"class",value:"[a-zA-Z$_]",description:"[a-zA-Z$_]"},Ya=/^[a-zA-Z0-9$_]/,Za={type:"class",value:"[a-zA-Z0-9$_]",description:"[a-zA-Z0-9$_]"},$a=function(a,b){return a+b.join("")},_a=function(a,b){return b},ab=function(a,b){return b?[a].concat(b).join("."):a},bb=/^[a-zA-Z]/,cb={type:"class",value:"[a-zA-Z]",description:"[a-zA-Z]"},db=/^[a-zA-Z0-9_]/,eb={type:"class",value:"[a-zA-Z0-9_]",description:"[a-zA-Z0-9_]"},fb="::",gb={type:"literal",value:"::",description:'"::"'},hb=function(a){return["identifier",[a,null]]},ib=function(a,b){return["identifier",[a,b]]},jb=function(a){return["identifier",["",a]]},kb=function(a){return a},lb=function(a){return a},mb=function(a){return a},nb=function(a,b){return["format",["\\n"+b.join("")]]},ob=function(a){return["buffer",[a.join("")]]},pb="rb",qb={type:"literal",value:"rb",description:'"rb"'},rb="lb",sb={type:"literal",value:"lb",description:'"lb"'},tb="s",ub={type:"literal",value:"s",description:'"s"'},vb="n",wb={type:"literal",value:"n",description:'"n"'},xb="r",yb={type:"literal",value:"r",description:'"r"'},zb="~",Ab={type:"literal",value:"~",description:'"~"'},Bb=function(a){return["escape",[a]]},Cb="*",Db={type:"literal",value:"*",description:'"*"'},Eb="`",Fb={type:"literal",value:"`",description:'"`"'},Gb=function(a){return $(["raw",[a.join("")]])},Hb="fn",Ib={type:"literal",value:"fn",description:'"fn"'},Jb=function(a){return a},Kb=function(a,b){return $(["fn",[a,b]])},Lb=function(a,b){return $(["call",[a,b]])},Mb=":",Nb={type:"literal",value:":",description:'":"'},Ob=function(a,b){return[a,b]},Pb=function(){return["map",[]]},Qb=function(a){return["map",[a]]},Rb=function(){return["array",[]]},Sb=function(a){return["array",[a]]},Tb=function(){return["empty",[]]},Ub="==",Vb={type:"literal",value:"==",description:'"=="'},Wb=function(){return"eq"},Xb="!=",Yb={type:"literal",value:"!=",description:'"!="'},Zb=function(){return"neq"},$b="<=",_b={type:"literal",value:"<=",description:'"<="'},ac=function(){return"lte"},bc=">=",cc={type:"literal",value:">=",description:'">="'},dc=function(){return"gte"},ec="<",fc={type:"literal",value:"<",description:'"<"'},gc=function(){return"lt"},hc=">",ic={type:"literal",value:">",description:'">"'},jc=function(){return"gt"},kc="and",lc={type:"literal",value:"and",description:'"and"'},mc=function(){return"cmpand"},nc="or",oc={type:"literal",value:"or",description:'"or"'},pc=function(){return"cmpor"},qc="not",rc={type:"literal",value:"not",description:'"not"'},sc=function(){return"not"},tc=function(a){return["identifier",[null,a]]},uc="+",vc={type:"literal",value:"+",description:'"+"'},wc=function(){return"add"},xc=function(){return"sub"},yc=function(){return"mul"},zc="/",Ac={type:"literal",value:"/",description:'"/"'},Bc=function(){return"div"},Cc="%",Dc={type:"literal",value:"%",description:'"%"'},Ec=function(){return"mod"},Fc=0,Gc=0,Hc=[{line:1,column:1,seenCR:!1}],Ic=0,Jc=[],Kc=0;if("startRule"in aa){if(!(aa.startRule in ca))throw new Error("Can't start parsing from rule \""+aa.startRule+'".');da=ca[aa.startRule]}if(_=da(),_!==ba&&Fc===a.length)return _;throw _!==ba&&Fc<a.length&&f({type:"end",description:"end of input"}),g(null,Jc,Ic<a.length?a.charAt(Ic):null,Ic<a.length?e(Ic,Ic+1):e(Ic,Ic))}return a(b,Error),{SyntaxError:b,parse:c}}();return Lisplate.Parser=a,a}),function(a,b){"function"==typeof define&&define.amd?define("lisplate.compiler",["lisplate.core","lisplate.parser"],b):"object"==typeof exports?module.exports=b(require("./"),require("./parser")):b(a.Lisplate,a.Lisplate.Parser)}(this,function(Lisplate,a){"use strict";function b(a,b,c,d){var e=a?a[3]:0,f=a?a[4]:0;return new g(b,c,d,{start:{offset:0,line:e,column:f},end:{offset:0,line:e,column:f}})}function c(a,b){return"$c."+a+"("+b+")\n"}function d(){this.internalsUsed=["escapeHtml"],this._expEscapeDisable=!1}function e(b,c){var e=new d;try{var f=a.parse(c);if("block"!==f[0])throw new g("Expected template to start with a block, but found "+f[0]+" instead","block",f[0],{start:{offset:0,line:0,column:0},end:{offset:0,line:0,column:0}});var h=e.processblock(f[1]),i=e.outputInternals(),j="function($$Lisplate,$$vmc){return function($data,$strings,$runtime) {var $viewmodel = $$vmc ? new $$vmc($data) : null;var $helper = $$Lisplate.helpers;var $_w = $runtime.Chunk;var $c = new $_w();\n"+i+h+"\nreturn $c.getOutput();\n}\n}";return j}catch(k){if(!k.location)throw k;var l=k.message+" ["+b+":"+k.location.start.line+":"+k.location.start.column+"]";throw new g(l,k.expected,k.found,k.location)}}function f(a,b){var c=e(a,b),d="(function(root, factory) {\nif (typeof define === 'function' && define.amd) {\ndefine('"+a+"', [], factory);\n} else if (typeof exports === 'object') {\nmodule.exports = factory();\n} else {\nroot['"+a+"'] = factory();\n}\n}(this, function() {\n'use strict';\nvar fn = "+c+"\nreturn {\ntemplateName: '"+a+"',\nrenderFactory: fn\n};\n}));\n";return d}var g=a.SyntaxError;return d.prototype.processblock=function(a){var b=this,d="",e=a.length,f="";return a.forEach(function(g,h){var i=g[0];if(i)if("format"===i||"buffer"===i){f+="format"===i?"":g[1];var j=h+1;j<e&&("format"===a[j][0]||"buffer"===a[j][0])||f.length&&(d+=c("w",'"'+f.replace(/"/g,'\\"')+'"'),f="")}else{var k=b.processexp(g);d+=c("w",k)}else d+=""}),d},d.prototype.processexp=function(a){var c=a[0];try{if("fn"===c)return this.processfn(a[1]);if("call"===c)return this.processcall(a[1]);if("raw"===c)return this.processraw(a[1]);if("escape"===c)return this.processescape(a[1]);if("identifier"===c)return this.processidentifier(a[1]);if("literal"===c)return this.processliteral(a[1]);if("map"===c)return this.processmap(a[1]);if("array"===c)return this.processarray(a[1]);if("empty"===c)return this.processempty();throw b(null,"Expected to find an expression type but did not find one","type","null")}catch(d){throw b(a,d.message,d.expected,d.found)}},d.prototype.useinternal=function(a){return this.internalsUsed.indexOf(a)===-1&&this.internalsUsed.push(a),"$i_"+a},d.prototype.processidentifier=function(a){var b=a[0],c=a[1];return b?c?"$"+b+"."+c:"$"+b:c},d.prototype.processliteral=function(a){return a[0]},d.prototype.processmap=function(a){var b=this,c=a[0],d="{";return c&&c.length&&(d+=c.map(function(a){return a[0]+":"+b.processexp(a[1])}).join(",")),d+="}"},d.prototype.processarray=function(a){var b=this,c=a[0],d="[";return c&&c.length&&(d+=c.map(function(a){return b.processexp(a)}).join(",")),d+="]"},d.prototype.processempty=function(){return"null"},d.prototype.processfn=function(a){var c=a[0],d=a[1],e="(function(";if(c&&c.length&&(e+=c.map(function(a){return a}).join(",")),e+=") {\nvar $c = new $_w();\n",!d||"block"!==d[0]||!d[1])throw b(null,"Expected function to contain a block","block",d?d[0]:"null");return e+=this.processblock(d[1]),e+="\n return $c;\n})\n"},d.prototype.processcall=function(a){var c=this,d=!this._expEscapeDisable,e=null,f=a[0][0];if("fn"===f)d=!1,e=c.processfn(a[0][1]);else{if("identifier"!==f)throw b(null,"Unknown callable","fn, identifier, or internal",f);e=c.processidentifier(a[0][1]),Lisplate.Runtime[e]?(d=!1,"safe"===e&&(this._expEscapeDisable=!0),e=c.useinternal(e)):"include"===e&&(d=!1,e="$$Lisplate.renderTemplate")}var g=a[1],h=e;return d&&(h=c.useinternal("escapeHtml")+"("+h),g&&g.length&&(h+="(",h+=g.map(function(a){return c.processexp(a)}).join(","),h+=")"),d&&(h+=")"),this._expEscapeDisable=!1,h},d.prototype.processraw=function(a){return'"'+a[0]+'"'},d.prototype.processescape=function(a){var b=a[0];if("s"===b)return'" "';if("n"===b)return'"\\n"';if("r"===b)return'"\\r"';if("lb"===b)return'"{"';if("rb"===b)return'"}"';throw new Error("Unknown escape: "+b)},d.prototype.outputInternals=function(){return"var "+this.internalsUsed.map(function(a){return"$i_"+a+"= $runtime."+a}).join(",\n")+";\n\n"},Lisplate.Compiler={compile:e,compileModule:f},Lisplate.Compiler});
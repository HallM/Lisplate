/*! lisplate - v0.6.0
* https://github.com/lisplate/lisplate
* Copyright (c) 2016 ; Released under the MIT License */
!function(a,b){"function"==typeof define&&define.amd?define("lisplate.utils",[],b):"object"==typeof exports?module.exports=b():(a.Lisplate={},a.Lisplate.Utils=b())}(this,function(){"use strict";return{loadCompiledSource:function loadCompiledSource(compiledSource){var template=null;return eval("template="+compiledSource),template},resolve:function(a){return"function"==typeof a?a():a},thenable:function(a){return("object"==typeof a||"function"==typeof a)&&"function"==typeof a.then}}}),function(a,b){"function"==typeof define&&define.amd?define("lisplate.runtime",["lisplate.utils"],b):"object"==typeof exports?module.exports=b(require("./util")):a.Lisplate.Runtime=b(a.Lisplate.Utils)}(this,function(a){"use strict";function b(a){var b=i[a];return function(a){return b[a]}}function c(a){var b=g[a],c=h[a],d=j[a],e=function(a){return f(a)?a.then(function(a){return e(a)}):b.test(a)?a.replace(c,d):a};return e}function d(){this.current="",this.stack=[],this.lastFlushedIndex=0,this.thenables=[],this.isAsync=!1,this.lastWasAsync=!1}var e=a.resolve,f=a.thenable,g={html:/[&<>\"\']/,js:/[\\\/\r\n\f\t'"\u2028\u2029]/,json:/["<\u2028\u2029]/},h={html:/[&<>\"\']/g,js:/[\\\/\r\n\f\t'"\u2028\u2029]/g,json:/["<\u2028\u2029]/g},i={html:{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"},js:{"\\":"\\\\","/":"\\/","\r":"\\r","\n":"\\n","\f":"\\f","\t":"\\t","'":"\\'",'"':'\\"',"\u2028":"\\u2028","\u2029":"\\u2029"},json:{'"':'\\"',"<":"\\u003c","\u2028":"\\u2029","\u2029":"\\u2029"}},j={html:b("html"),js:b("js"),json:b("json")},k={escapeHtml:c("html"),escapeJs:c("js"),escapeJson:c("json"),get:function(a,b){return b?a[b]:a},not:function(a){return!a},eq:function(a,b){return a===b},neq:function(a,b){return a!==b},lt:function(a,b){return a<b},gt:function(a,b){return a>b},lte:function(a,b){return a<=b},gte:function(a,b){return a>=b},cmpand:function(a,b){return a&&b},cmpor:function(a,b){return a||b},add:function(a,b){return a+b},sub:function(a,b){return a-b},mul:function(a,b){return a*b},div:function(a,b){return a/b},mod:function(a,b){return a%b},each:function(a,b,c){var g=a;if(f(g))return g.then(function(a){return k.each(a,b,c)});var h=0;if(g&&(h=g.length)){if(b){for(var i=new d,j=0;j<h;j++)"function"==typeof b?i.w(b(g[j],j)):i.w(b);return i.getOutput()}}else if(c)return e(c);return""},"if":function(a,b,c){var d=a;if(f(d))return d.then(function(a){return k["if"](a,b,c)});if(d){if(b)return e(b)}else if(c)return e(c);return""},isEmpty:function(a){var b=a;return 0!==b&&(!(!Array.isArray(b)||b.length)||!b)},isNotEmpty:function(a){return!k.isEmpty(a)}};return d.prototype.w=function(a){var b=a;if(null!=b)if(b instanceof d&&(b=b.getOutput()),f(b)){this.current.length&&(this.stack.push(this.current),this.current=""),this.isAsync=!0,this.lastWasAsync=!0;var c=this.stack.length;this.stack.push("");var e=this,g=b.then(function(a){e.stack[c]=a});this.thenables.push(g)}else this.lastWasAsync?this.current=b:this.current+=b,this.lastWasAsync=!1},d.prototype.getOutput=function(){var a=this;return a.isAsync?(a.current.length&&a.stack.push(a.current),Promise.all(a.thenables).then(function(){return a.stack.join("")})):a.current},k.Chunk=d,k}),function(a,b){"function"==typeof define&&define.amd?define("lisplate.core",["lisplate.runtime","lisplate.utils"],b):"object"==typeof exports?module.exports=b(require("./runtime"),require("./util")):a.Lisplate=b(a.Lisplate.Runtime,a.Lisplate.Utils)}(this,function(a,b){"use strict";function c(a){return function(){var b=arguments.length,c=b?arguments[b-1]:null,d=null;"function"==typeof c?d=Array.prototype.slice.call(arguments,0,b-1):(d=Array.prototype.slice.call(arguments,0,b),c=null);var f=a.apply(this,d);return e(f)?c?void f.then(function(a){c(null,a)})["catch"](function(a){c(a)}):f:c?void c(null,f):f}}function d(a){var b=a.length;return function(){var c=Array.prototype.slice.apply(arguments),d=c.length;return b===d+1?new Promise(function(b,d){c.push(function(a,c){return a?void d(a):void b(c)}),a.apply(null,c)}):Promise.resolve(a.apply(null,c))}}function Lisplate(a){a||(a={}),this.cacheEnabled=!(a.cacheEnabled===!1),this.sourceLoader=a.sourceLoader,this.viewModelLoader=a.viewModelLoader,this.stringsLoader=a.stringsLoader,this.compilerOptions=a.compilerOptions,this.helpers={},this.cache={}}var e=b.thenable;return Lisplate.Runtime=a,Lisplate.Utils=b,Lisplate.FactoryCache={},Lisplate.prototype.addHelper=function(a,b){this.helpers[a]=b},Lisplate.prototype.loadTemplate=c(function(a){var b=this;if(!a)return Promise.reject(new Error("Must specify template information to load"));var c="string"==typeof a?a:a.templateName,e=a.renderFactory;if(""===c)return Promise.reject(new Error("Must specify a valid template name to load"));if(e)e=Promise.resolve(e);else{if(b.cacheEnabled&&b.cache[c])return Promise.resolve(b.cache[c]);if(b.cacheEnabled&&Lisplate.FactoryCache[c])e=Promise.resolve(Lisplate.FactoryCache[c]);else{if(!b.sourceLoader)return Promise.reject(new Error("Must define a sourceLoader"));if(!Lisplate.Compiler||!Lisplate.Compiler.compile)return Promise.reject("Compiler is not loaded to compile loaded source");e=d(b.sourceLoader)(c).then(function(a){var d=null,e=null;try{d=Lisplate.Compiler.compile(c,a,b.compilerOptions),e=Lisplate.Utils.loadCompiledSource(d)}catch(f){return Promise.reject(f)}return Promise.resolve(e)})}}return e.then(function(a){b.cacheEnabled&&(Lisplate.FactoryCache[c]=a);var e=null;return e=b.viewModelLoader?d(b.viewModelLoader)(c):Promise.resolve(null),e.then(function(d){var e=a(b,d);return e.templateName=c,b.cacheEnabled&&(b.cache[c]=e),e})})}),Lisplate.prototype.render=c(function(a,b,c){var e=this;return e.stringsLoader?d(e.stringsLoader)(a.templateName,c).then(function(d){return a(b,d,Lisplate.Runtime,c)}):a(b,null,Lisplate.Runtime,c)}),Lisplate.prototype.renderTemplate=c(function(a,b,c){var d=this;return d.loadTemplate(a).then(function(a){return d.render(a,b,c)})}),Lisplate}),function(a,b){"function"==typeof define&&define.amd?define("lisplate.parser",["lisplate.core"],b):"object"==typeof exports?module.exports=b(require("./")):b(a.Lisplate)}(this,function(Lisplate){var a=function(){"use strict";function a(a,b){function c(){this.constructor=a}c.prototype=b.prototype,a.prototype=new c}function b(a,c,d,e){this.message=a,this.expected=c,this.found=d,this.location=e,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,b)}function c(a){function c(){return e(Oc,Nc)}function d(b){var c,d,e=Pc[b];if(e)return e;for(c=b-1;!Pc[c];)c--;for(e=Pc[c],e={line:e.line,column:e.column,seenCR:e.seenCR};c<b;)d=a.charAt(c),"\n"===d?(e.seenCR||e.line++,e.column=1,e.seenCR=!1):"\r"===d||"\u2028"===d||"\u2029"===d?(e.line++,e.column=1,e.seenCR=!0):(e.column++,e.seenCR=!1),c++;return Pc[b]=e,e}function e(a,b){var c=d(a),e=d(b);return{start:{offset:a,line:c.line,column:c.column},end:{offset:b,line:e.line,column:e.column}}}function f(a){Nc<Qc||(Nc>Qc&&(Qc=Nc,Rc=[]),Rc.push(a))}function g(a,c,d,e){function f(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,1):b++}function g(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0100-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1000-\uFFFF]/g,function(a){return"\\u"+b(a)})}var d,e,f,g=new Array(a.length);for(f=0;f<a.length;f++)g[f]=a[f].description;return d=a.length>1?g.slice(0,-1).join(", ")+" or "+g[a.length-1]:g[0],e=b?'"'+c(b)+'"':"end of input","Expected "+d+" but "+e+" found."}return null!==c&&f(c),new b(null!==a?a:g(c,d),c,d,e)}function h(){var a;return a=i()}function i(){var a,b,c,d,e;for(a=Nc,b=[],c=Nc,d=[],e=J();e!==fa;)d.push(e),e=J();for(d!==fa?(e=W(),e===fa&&(e=E()),e!==fa?(Oc=c,d=ia(e),c=d):(Nc=c,c=fa)):(Nc=c,c=fa);c!==fa;){for(b.push(c),c=Nc,d=[],e=J();e!==fa;)d.push(e),e=J();d!==fa?(e=W(),e===fa&&(e=E()),e!==fa?(Oc=c,d=ia(e),c=d):(Nc=c,c=fa)):(Nc=c,c=fa)}if(b!==fa){for(c=[],d=J();d!==fa;)c.push(d),d=J();c!==fa?(Oc=a,b=ja(b),a=b):(Nc=a,a=fa)}else Nc=a,a=fa;return a}function j(){var b;return 10===a.charCodeAt(Nc)?(b=ka,Nc++):(b=fa,0===Sc&&f(la)),b===fa&&(a.substr(Nc,2)===ma?(b=ma,Nc+=2):(b=fa,0===Sc&&f(na)),b===fa&&(13===a.charCodeAt(Nc)?(b=oa,Nc++):(b=fa,0===Sc&&f(pa)),b===fa&&(8232===a.charCodeAt(Nc)?(b=qa,Nc++):(b=fa,0===Sc&&f(ra)),b===fa&&(8233===a.charCodeAt(Nc)?(b=sa,Nc++):(b=fa,0===Sc&&f(ta)))))),b}function k(){var b;return ua.test(a.charAt(Nc))?(b=a.charAt(Nc),Nc++):(b=fa,0===Sc&&f(va)),b===fa&&(b=j()),b}function l(){var b;return 123===a.charCodeAt(Nc)?(b=wa,Nc++):(b=fa,0===Sc&&f(xa)),b}function m(){var b;return 125===a.charCodeAt(Nc)?(b=ya,Nc++):(b=fa,0===Sc&&f(za)),b}function n(){var b;return 40===a.charCodeAt(Nc)?(b=Aa,Nc++):(b=fa,0===Sc&&f(Ba)),b}function o(){var b;return 41===a.charCodeAt(Nc)?(b=Ca,Nc++):(b=fa,0===Sc&&f(Da)),b}function p(){var b,c,d,e,g,h,i;if(b=Nc,34===a.charCodeAt(Nc)?(c=Ea,Nc++):(c=fa,0===Sc&&f(Fa)),c!==fa){for(d=[],e=Nc,g=Nc,Sc++,34===a.charCodeAt(Nc)?(h=Ea,Nc++):(h=fa,0===Sc&&f(Fa)),Sc--,h===fa?g=void 0:(Nc=g,g=fa),g!==fa?(h=Nc,Sc++,i=j(),Sc--,i===fa?h=void 0:(Nc=h,h=fa),h!==fa?(a.length>Nc?(i=a.charAt(Nc),Nc++):(i=fa,0===Sc&&f(Ga)),i!==fa?(Oc=e,g=Ha(i),e=g):(Nc=e,e=fa)):(Nc=e,e=fa)):(Nc=e,e=fa);e!==fa;)d.push(e),e=Nc,g=Nc,Sc++,34===a.charCodeAt(Nc)?(h=Ea,Nc++):(h=fa,0===Sc&&f(Fa)),Sc--,h===fa?g=void 0:(Nc=g,g=fa),g!==fa?(h=Nc,Sc++,i=j(),Sc--,i===fa?h=void 0:(Nc=h,h=fa),h!==fa?(a.length>Nc?(i=a.charAt(Nc),Nc++):(i=fa,0===Sc&&f(Ga)),i!==fa?(Oc=e,g=Ha(i),e=g):(Nc=e,e=fa)):(Nc=e,e=fa)):(Nc=e,e=fa);d!==fa?(34===a.charCodeAt(Nc)?(e=Ea,Nc++):(e=fa,0===Sc&&f(Fa)),e!==fa?(Oc=b,c=Ia(d),b=c):(Nc=b,b=fa)):(Nc=b,b=fa)}else Nc=b,b=fa;return b}function q(){var a,b;return a=Nc,b=r(),b===fa&&(b=u()),b!==fa&&(Oc=a,b=Ja(b)),a=b}function r(){var b,c,d,e;return b=Nc,c=u(),c!==fa?(46===a.charCodeAt(Nc)?(d=Ka,Nc++):(d=fa,0===Sc&&f(La)),d!==fa?(e=s(),e!==fa?(Oc=b,c=Ma(c,e),b=c):(Nc=b,b=fa)):(Nc=b,b=fa)):(Nc=b,b=fa),b}function s(){var b,c,d;if(b=Nc,c=[],Na.test(a.charAt(Nc))?(d=a.charAt(Nc),Nc++):(d=fa,0===Sc&&f(Oa)),d!==fa)for(;d!==fa;)c.push(d),Na.test(a.charAt(Nc))?(d=a.charAt(Nc),Nc++):(d=fa,0===Sc&&f(Oa));else c=fa;return c!==fa&&(Oc=b,c=Pa(c)),b=c}function t(){var b,c,d;return b=Nc,45===a.charCodeAt(Nc)?(c=Qa,Nc++):(c=fa,0===Sc&&f(Ra)),c!==fa?(d=s(),d!==fa?(Oc=b,c=Sa(d),b=c):(Nc=b,b=fa)):(Nc=b,b=fa),b}function u(){var a;return a=t(),a===fa&&(a=s()),a}function v(){var b,c;return b=Nc,a.substr(Nc,4)===Ta?(c=Ta,Nc+=4):(c=fa,0===Sc&&f(Ua)),c!==fa&&(Oc=b,c=Va()),b=c,b===fa&&(b=Nc,a.substr(Nc,5)===Wa?(c=Wa,Nc+=5):(c=fa,0===Sc&&f(Xa)),c!==fa&&(Oc=b,c=Ya()),b=c),b}function w(){var a,b;return a=Nc,b=p(),b===fa&&(b=q(),b===fa&&(b=v())),b!==fa&&(Oc=a,b=Za(b)),a=b}function x(){var b,c,d,e;if(b=Nc,$a.test(a.charAt(Nc))?(c=a.charAt(Nc),Nc++):(c=fa,0===Sc&&f(_a)),c!==fa){for(d=[],ab.test(a.charAt(Nc))?(e=a.charAt(Nc),Nc++):(e=fa,0===Sc&&f(bb));e!==fa;)d.push(e),ab.test(a.charAt(Nc))?(e=a.charAt(Nc),Nc++):(e=fa,0===Sc&&f(bb));d!==fa?(Oc=b,c=cb(c,d),b=c):(Nc=b,b=fa)}else Nc=b,b=fa;return b}function y(){var b,c,d,e,g,h;if(b=Nc,c=x(),c!==fa){for(d=[],e=Nc,46===a.charCodeAt(Nc)?(g=Ka,Nc++):(g=fa,0===Sc&&f(La)),g!==fa?(h=x(),h!==fa?(Oc=e,g=db(c,h),e=g):(Nc=e,e=fa)):(Nc=e,e=fa);e!==fa;)d.push(e),e=Nc,46===a.charCodeAt(Nc)?(g=Ka,Nc++):(g=fa,0===Sc&&f(La)),g!==fa?(h=x(),h!==fa?(Oc=e,g=db(c,h),e=g):(Nc=e,e=fa)):(Nc=e,e=fa);d!==fa?(Oc=b,c=eb(c,d),b=c):(Nc=b,b=fa)}else Nc=b,b=fa;return b}function z(){var b,c,d,e;if(b=Nc,fb.test(a.charAt(Nc))?(c=a.charAt(Nc),Nc++):(c=fa,0===Sc&&f(gb)),c!==fa){for(d=[],hb.test(a.charAt(Nc))?(e=a.charAt(Nc),Nc++):(e=fa,0===Sc&&f(ib));e!==fa;)d.push(e),hb.test(a.charAt(Nc))?(e=a.charAt(Nc),Nc++):(e=fa,0===Sc&&f(ib));d!==fa?(Oc=b,c=cb(c,d),b=c):(Nc=b,b=fa)}else Nc=b,b=fa;return b}function A(){var b;return a.substr(Nc,2)===jb?(b=jb,Nc+=2):(b=fa,0===Sc&&f(kb)),b}function B(){var b,c,d,e;return b=Nc,c=z(),c!==fa?(d=A(),d!==fa?(46===a.charCodeAt(Nc)?(e=Ka,Nc++):(e=fa,0===Sc&&f(La)),e!==fa?(Oc=b,c=lb(c),b=c):(Nc=b,b=fa)):(Nc=b,b=fa)):(Nc=b,b=fa),b===fa&&(b=Nc,c=z(),c!==fa?(d=A(),d!==fa?(e=y(),e!==fa?(Oc=b,c=mb(c,e),b=c):(Nc=b,b=fa)):(Nc=b,b=fa)):(Nc=b,b=fa),b===fa&&(b=Nc,c=y(),c!==fa&&(Oc=b,c=nb(c)),b=c)),b}function C(){var a,b,c,d,e,f,g;if(a=Nc,b=n(),b!==fa)if(c=K(),c!==fa){for(d=[],e=Nc,f=y(),f!==fa?(g=K(),g!==fa?(Oc=e,f=ob(f),e=f):(Nc=e,e=fa)):(Nc=e,e=fa);e!==fa;)d.push(e),e=Nc,f=y(),f!==fa?(g=K(),g!==fa?(Oc=e,f=ob(f),e=f):(Nc=e,e=fa)):(Nc=e,e=fa);d!==fa?(e=K(),e!==fa?(f=o(),f!==fa?(Oc=a,b=pb(d),a=b):(Nc=a,a=fa)):(Nc=a,a=fa)):(Nc=a,a=fa)}else Nc=a,a=fa;else Nc=a,a=fa;return a}function D(){var a,b,c,d,e;for(a=Nc,b=[],c=Nc,d=X(),d!==fa?(e=K(),e!==fa?(Oc=c,d=qb(d),c=d):(Nc=c,c=fa)):(Nc=c,c=fa);c!==fa;)b.push(c),c=Nc,d=X(),d!==fa?(e=K(),e!==fa?(Oc=c,d=qb(d),c=d):(Nc=c,c=fa)):(Nc=c,c=fa);return b!==fa&&(Oc=a,b=pb(b)),a=b}function E(){var b,c,d,e,g,h,i,n;if(b=Nc,c=j(),c!==fa){for(d=[],e=k();e!==fa;)d.push(e),e=k();d!==fa?(Oc=b,c=rb(c,d),b=c):(Nc=b,b=fa)}else Nc=b,b=fa;if(b===fa){if(b=Nc,c=[],d=Nc,e=Nc,Sc++,g=J(),Sc--,g===fa?e=void 0:(Nc=e,e=fa),e!==fa?(g=Nc,Sc++,h=l(),Sc--,h===fa?g=void 0:(Nc=g,g=fa),g!==fa?(h=Nc,Sc++,i=m(),Sc--,i===fa?h=void 0:(Nc=h,h=fa),h!==fa?(i=Nc,Sc++,n=j(),Sc--,n===fa?i=void 0:(Nc=i,i=fa),i!==fa?(a.length>Nc?(n=a.charAt(Nc),Nc++):(n=fa,0===Sc&&f(Ga)),n!==fa?(Oc=d,e=Ha(n),d=e):(Nc=d,d=fa)):(Nc=d,d=fa)):(Nc=d,d=fa)):(Nc=d,d=fa)):(Nc=d,d=fa),d!==fa)for(;d!==fa;)c.push(d),d=Nc,e=Nc,Sc++,g=J(),Sc--,g===fa?e=void 0:(Nc=e,e=fa),e!==fa?(g=Nc,Sc++,h=l(),Sc--,h===fa?g=void 0:(Nc=g,g=fa),g!==fa?(h=Nc,Sc++,i=m(),Sc--,i===fa?h=void 0:(Nc=h,h=fa),h!==fa?(i=Nc,Sc++,n=j(),Sc--,n===fa?i=void 0:(Nc=i,i=fa),i!==fa?(a.length>Nc?(n=a.charAt(Nc),Nc++):(n=fa,0===Sc&&f(Ga)),n!==fa?(Oc=d,e=Ha(n),d=e):(Nc=d,d=fa)):(Nc=d,d=fa)):(Nc=d,d=fa)):(Nc=d,d=fa)):(Nc=d,d=fa);else c=fa;c!==fa&&(Oc=b,c=sb(c)),b=c}return b}function F(){var b;return a.substr(Nc,2)===tb?(b=tb,Nc+=2):(b=fa,0===Sc&&f(ub)),b===fa&&(a.substr(Nc,2)===vb?(b=vb,Nc+=2):(b=fa,0===Sc&&f(wb)),b===fa&&(115===a.charCodeAt(Nc)?(b=xb,Nc++):(b=fa,0===Sc&&f(yb)),b===fa&&(110===a.charCodeAt(Nc)?(b=zb,Nc++):(b=fa,0===Sc&&f(Ab)),b===fa&&(114===a.charCodeAt(Nc)?(b=Bb,Nc++):(b=fa,0===Sc&&f(Cb)))))),b}function G(){var b,c,d,e,g;return b=Nc,c=l(),c!==fa?(126===a.charCodeAt(Nc)?(d=Db,Nc++):(d=fa,0===Sc&&f(Eb)),d!==fa?(e=F(),e!==fa?(g=m(),g!==fa?(Oc=b,c=Fb(e),b=c):(Nc=b,b=fa)):(Nc=b,b=fa)):(Nc=b,b=fa)):(Nc=b,b=fa),b}function H(){var b,c,d;return b=Nc,c=l(),c!==fa?(42===a.charCodeAt(Nc)?(d=Gb,Nc++):(d=fa,0===Sc&&f(Hb)),d!==fa?(c=[c,d],b=c):(Nc=b,b=fa)):(Nc=b,b=fa),b}function I(){var b,c,d;return b=Nc,42===a.charCodeAt(Nc)?(c=Gb,Nc++):(c=fa,0===Sc&&f(Hb)),c!==fa?(d=m(),d!==fa?(c=[c,d],b=c):(Nc=b,b=fa)):(Nc=b,b=fa),b}function J(){var b,c,d,e,g,h;if(b=Nc,c=H(),c!==fa){for(d=[],e=Nc,g=Nc,Sc++,h=I(),Sc--,h===fa?g=void 0:(Nc=g,g=fa),g!==fa?(a.length>Nc?(h=a.charAt(Nc),Nc++):(h=fa,0===Sc&&f(Ga)),h!==fa?(g=[g,h],e=g):(Nc=e,e=fa)):(Nc=e,e=fa);e!==fa;)d.push(e),e=Nc,g=Nc,Sc++,h=I(),Sc--,h===fa?g=void 0:(Nc=g,g=fa),g!==fa?(a.length>Nc?(h=a.charAt(Nc),Nc++):(h=fa,0===Sc&&f(Ga)),h!==fa?(g=[g,h],e=g):(Nc=e,e=fa)):(Nc=e,e=fa);d!==fa?(e=I(),e!==fa?(c=[c,d,e],b=c):(Nc=b,b=fa)):(Nc=b,b=fa)}else Nc=b,b=fa;return b}function K(){var a,b;for(a=[],b=k(),b===fa&&(b=J());b!==fa;)a.push(b),b=k(),b===fa&&(b=J());return a}function L(){var b,c,d;return b=Nc,c=l(),c!==fa?(96===a.charCodeAt(Nc)?(d=Ib,Nc++):(d=fa,0===Sc&&f(Jb)),d!==fa?(c=[c,d],b=c):(Nc=b,b=fa)):(Nc=b,b=fa),b}function M(){var b,c,d;return b=Nc,96===a.charCodeAt(Nc)?(c=Ib,Nc++):(c=fa,0===Sc&&f(Jb)),c!==fa?(d=m(),d!==fa?(c=[c,d],b=c):(Nc=b,b=fa)):(Nc=b,b=fa),b}function N(){var b,c,d,e,g,h;if(b=Nc,c=L(),c!==fa){for(d=[],e=Nc,g=Nc,Sc++,h=M(),Sc--,h===fa?g=void 0:(Nc=g,g=fa),g!==fa?(a.length>Nc?(h=a.charAt(Nc),Nc++):(h=fa,0===Sc&&f(Ga)),h!==fa?(Oc=e,g=Ha(h),e=g):(Nc=e,e=fa)):(Nc=e,e=fa);e!==fa;)d.push(e),e=Nc,g=Nc,Sc++,h=M(),Sc--,h===fa?g=void 0:(Nc=g,g=fa),g!==fa?(a.length>Nc?(h=a.charAt(Nc),Nc++):(h=fa,0===Sc&&f(Ga)),h!==fa?(Oc=e,g=Ha(h),e=g):(Nc=e,e=fa)):(Nc=e,e=fa);d!==fa?(e=M(),e!==fa?(Oc=b,c=Kb(d),b=c):(Nc=b,b=fa)):(Nc=b,b=fa)}else Nc=b,b=fa;return b}function O(){var b,c,d,e,g,h,j,k,n;return b=Nc,c=l(),c!==fa?(d=K(),d!==fa?(a.substr(Nc,2)===Lb?(e=Lb,Nc+=2):(e=fa,0===Sc&&f(Mb)),e!==fa?(g=K(),g!==fa?(h=Nc,j=C(),j!==fa?(k=K(),k!==fa?(Oc=h,j=Nb(j),h=j):(Nc=h,h=fa)):(Nc=h,h=fa),h===fa&&(h=null),h!==fa?(j=i(),j!==fa?(k=K(),k!==fa?(n=m(),n!==fa?(Oc=b,c=Ob(h,j),b=c):(Nc=b,b=fa)):(Nc=b,b=fa)):(Nc=b,b=fa)):(Nc=b,b=fa)):(Nc=b,b=fa)):(Nc=b,b=fa)):(Nc=b,b=fa)):(Nc=b,b=fa),b}function P(){var b;return 124===a.charCodeAt(Nc)?(b=Pb,Nc++):(b=fa,0===Sc&&f(Qb)),b}function Q(){var a,b,c,d,e,f,g,h,i;if(a=Nc,b=l(),b!==fa)if(c=K(),c!==fa)if(d=_(),d!==fa)if(e=K(),e!==fa){if(f=[],g=Nc,h=P(),h!==fa?(i=aa(),i!==fa?(Oc=g,h=Rb(i),g=h):(Nc=g,g=fa)):(Nc=g,g=fa),g!==fa)for(;g!==fa;)f.push(g),g=Nc,h=P(),h!==fa?(i=aa(),i!==fa?(Oc=g,h=Rb(i),g=h):(Nc=g,g=fa)):(Nc=g,g=fa);else f=fa;f!==fa?(g=K(),g!==fa?(h=m(),h!==fa?(Oc=a,b=Sb(d,f),a=b):(Nc=a,a=fa)):(Nc=a,a=fa)):(Nc=a,a=fa)}else Nc=a,a=fa;else Nc=a,a=fa;else Nc=a,a=fa;else Nc=a,a=fa;return a}function R(){var a,b,c,d,e,f,g,h;return a=Nc,b=l(),b!==fa?(c=K(),c!==fa?(d=$(),d!==fa?(e=K(),e!==fa?(f=D(),f!==fa?(g=K(),g!==fa?(h=m(),h!==fa?(Oc=a,b=Tb(d,f),a=b):(Nc=a,a=fa)):(Nc=a,a=fa)):(Nc=a,a=fa)):(Nc=a,a=fa)):(Nc=a,a=fa)):(Nc=a,a=fa)):(Nc=a,a=fa),a}function S(){var b,c,d,e,g;return b=Nc,58===a.charCodeAt(Nc)?(c=Ub,Nc++):(c=fa,0===Sc&&f(Vb)),c!==fa?(d=y(),d!==fa?(e=K(),e!==fa?(g=X(),g!==fa?(Oc=b,c=Wb(d,g),b=c):(Nc=b,b=fa)):(Nc=b,b=fa)):(Nc=b,b=fa)):(Nc=b,b=fa),b}function T(){var b,c,d,e,g,h,i;if(b=Nc,c=n(),c!==fa?(58===a.charCodeAt(Nc)?(d=Ub,Nc++):(d=fa,0===Sc&&f(Vb)),d!==fa?(e=o(),e!==fa?(Oc=b,c=Xb(),b=c):(Nc=b,b=fa)):(Nc=b,b=fa)):(Nc=b,b=fa),b===fa)if(b=Nc,c=n(),c!==fa)if(d=K(),d!==fa){if(e=[],g=Nc,h=S(),h!==fa?(i=K(),i!==fa?(Oc=g,h=qb(h),g=h):(Nc=g,g=fa)):(Nc=g,g=fa),g!==fa)for(;g!==fa;)e.push(g),g=Nc,h=S(),h!==fa?(i=K(),i!==fa?(Oc=g,h=qb(h),g=h):(Nc=g,g=fa)):(Nc=g,g=fa);else e=fa;e!==fa?(g=K(),g!==fa?(h=o(),h!==fa?(Oc=b,c=Yb(e),b=c):(Nc=b,b=fa)):(Nc=b,b=fa)):(Nc=b,b=fa)}else Nc=b,b=fa;else Nc=b,b=fa;return b}function U(){var a,b,c,d,e,f,g;if(a=Nc,b=n(),b!==fa?(c=o(),c!==fa?(Oc=a,b=Zb(),a=b):(Nc=a,a=fa)):(Nc=a,a=fa),a===fa)if(a=Nc,b=n(),b!==fa)if(c=K(),c!==fa){if(d=[],e=Nc,f=X(),f!==fa?(g=K(),g!==fa?(Oc=e,f=qb(f),e=f):(Nc=e,e=fa)):(Nc=e,e=fa),e!==fa)for(;e!==fa;)d.push(e),e=Nc,f=X(),f!==fa?(g=K(),g!==fa?(Oc=e,f=qb(f),e=f):(Nc=e,e=fa)):(Nc=e,e=fa);else d=fa;d!==fa?(e=K(),e!==fa?(f=o(),f!==fa?(Oc=a,b=$b(d),a=b):(Nc=a,a=fa)):(Nc=a,a=fa)):(Nc=a,a=fa)}else Nc=a,a=fa;else Nc=a,a=fa;return a}function V(){var a,b,c;return a=Nc,b=l(),b!==fa?(c=m(),c!==fa?(Oc=a,b=_b(),a=b):(Nc=a,a=fa)):(Nc=a,a=fa),a}function W(){var a;return a=O(),a===fa&&(a=Q(),a===fa&&(a=R(),a===fa&&(a=N(),a===fa&&(a=G(),a===fa&&(a=V()))))),a}function X(){var a;return a=W(),a===fa&&(a=w(),a===fa&&(a=T(),a===fa&&(a=U(),a===fa&&(a=B())))),a}function Y(){var b,c,d;return b=Nc,c=Nc,a.substr(Nc,2)===ac?(d=ac,Nc+=2):(d=fa,0===Sc&&f(bc)),d!==fa&&(Oc=c,d=cc()),c=d,c===fa&&(c=Nc,a.substr(Nc,2)===dc?(d=dc,Nc+=2):(d=fa,0===Sc&&f(ec)),d!==fa&&(Oc=c,d=fc()),c=d,c===fa&&(c=Nc,a.substr(Nc,2)===gc?(d=gc,Nc+=2):(d=fa,0===Sc&&f(hc)),d!==fa&&(Oc=c,d=ic()),c=d,c===fa&&(c=Nc,a.substr(Nc,2)===jc?(d=jc,Nc+=2):(d=fa,0===Sc&&f(kc)),d!==fa&&(Oc=c,d=lc()),c=d,c===fa&&(c=Nc,60===a.charCodeAt(Nc)?(d=mc,Nc++):(d=fa,0===Sc&&f(nc)),d!==fa&&(Oc=c,d=oc()),c=d,c===fa&&(c=Nc,62===a.charCodeAt(Nc)?(d=pc,Nc++):(d=fa,0===Sc&&f(qc)),d!==fa&&(Oc=c,d=rc()),c=d,c===fa&&(c=Nc,a.substr(Nc,3)===sc?(d=sc,Nc+=3):(d=fa,0===Sc&&f(tc)),d!==fa&&(Oc=c,d=uc()),c=d,c===fa&&(c=Nc,a.substr(Nc,2)===vc?(d=vc,Nc+=2):(d=fa,0===Sc&&f(wc)),d!==fa&&(Oc=c,d=xc()),c=d,c===fa&&(c=Nc,a.substr(Nc,3)===yc?(d=yc,Nc+=3):(d=fa,0===Sc&&f(zc)),d!==fa&&(Oc=c,d=Ac()),c=d)))))))),c!==fa&&(Oc=b,c=Bc(c)),b=c}function Z(){var b,c,d;return b=Nc,c=Nc,43===a.charCodeAt(Nc)?(d=Cc,Nc++):(d=fa,0===Sc&&f(Dc)),d!==fa&&(Oc=c,d=Ec()),c=d,c===fa&&(c=Nc,45===a.charCodeAt(Nc)?(d=Qa,Nc++):(d=fa,0===Sc&&f(Ra)),d!==fa&&(Oc=c,d=Fc()),c=d,c===fa&&(c=Nc,42===a.charCodeAt(Nc)?(d=Gb,Nc++):(d=fa,0===Sc&&f(Hb)),d!==fa&&(Oc=c,d=Gc()),c=d,c===fa&&(c=Nc,47===a.charCodeAt(Nc)?(d=Hc,Nc++):(d=fa,0===Sc&&f(Ic)),d!==fa&&(Oc=c,d=Jc()),c=d,c===fa&&(c=Nc,37===a.charCodeAt(Nc)?(d=Kc,Nc++):(d=fa,0===Sc&&f(Lc)),d!==fa&&(Oc=c,d=Mc()),c=d)))),c!==fa&&(Oc=b,c=Bc(c)),b=c}function $(){var a;return a=O(),a===fa&&(a=Y(),a===fa&&(a=Z(),a===fa&&(a=B()))),a}function _(){var a;return a=O(),a===fa&&(a=T(),a===fa&&(a=U(),a===fa&&(a=w(),a===fa&&(a=B())))),a}function aa(){var a;return a=O(),a===fa&&(a=B()),a}function ba(a){return parseInt(a.join(""),10)}function ca(a){var b=c().start;return a.concat([b.line,b.column])}var da,ea=arguments.length>1?arguments[1]:{},fa={},ga={start:h},ha=h,ia=function(a){return a},ja=function(a){return ca(["block",a])},ka="\n",la={type:"literal",value:"\n",description:'"\\n"'},ma="\r\n",na={type:"literal",value:"\r\n",description:'"\\r\\n"'},oa="\r",pa={type:"literal",value:"\r",description:'"\\r"'},qa="\u2028",ra={type:"literal",value:"\u2028",description:'"\\u2028"'},sa="\u2029",ta={type:"literal",value:"\u2029",description:'"\\u2029"'},ua=/^[\t\x0B\f \xA0\uFEFF]/,va={type:"class",value:"[\\t\\v\\f \\u00A0\\uFEFF]",description:"[\\t\\v\\f \\u00A0\\uFEFF]"},wa="{",xa={type:"literal",value:"{",description:'"{"'},ya="}",za={type:"literal",value:"}",description:'"}"'},Aa="(",Ba={type:"literal",value:"(",description:'"("'},Ca=")",Da={type:"literal",value:")",description:'")"'},Ea='"',Fa={type:"literal",value:'"',description:'"\\""'},Ga={type:"any",description:"any character"},Ha=function(a){return a},Ia=function(a){return'"'+a.join("")+'"'},Ja=function(a){return a},Ka=".",La={type:"literal",value:".",description:'"."'},Ma=function(a,b){return parseFloat(a+"."+b)},Na=/^[0-9]/,Oa={type:"class",value:"[0-9]",description:"[0-9]"},Pa=function(a){return ba(a)},Qa="-",Ra={type:"literal",value:"-",description:'"-"'},Sa=function(a){return a*-1},Ta="true",Ua={type:"literal",value:"true",description:'"true"'},Va=function(){return!0},Wa="false",Xa={type:"literal",value:"false",description:'"false"'},Ya=function(){return!1},Za=function(a){return ca(["literal",[a]])},$a=/^[a-zA-Z$_]/,_a={type:"class",value:"[a-zA-Z$_]",description:"[a-zA-Z$_]"},ab=/^[a-zA-Z0-9$_]/,bb={type:"class",value:"[a-zA-Z0-9$_]",description:"[a-zA-Z0-9$_]"},cb=function(a,b){return a+b.join("")},db=function(a,b){return b},eb=function(a,b){return b?[a].concat(b).join("."):a},fb=/^[a-zA-Z]/,gb={type:"class",value:"[a-zA-Z]",description:"[a-zA-Z]"},hb=/^[a-zA-Z0-9_]/,ib={type:"class",value:"[a-zA-Z0-9_]",description:"[a-zA-Z0-9_]"},jb="::",kb={type:"literal",value:"::",description:'"::"'},lb=function(a){return ca(["identifier",[a,null]])},mb=function(a,b){return ca(["identifier",[a,b]])},nb=function(a){return ca(["identifier",["",a]])},ob=function(a){return a},pb=function(a){return a},qb=function(a){return a},rb=function(a,b){return ca(["format",["\\n"+b.join("")]])},sb=function(a){return ca(["buffer",[a.join("")]])},tb="rb",ub={type:"literal",value:"rb",description:'"rb"'},vb="lb",wb={type:"literal",value:"lb",description:'"lb"'},xb="s",yb={type:"literal",value:"s",description:'"s"'},zb="n",Ab={type:"literal",value:"n",description:'"n"'},Bb="r",Cb={type:"literal",value:"r",description:'"r"'},Db="~",Eb={type:"literal",value:"~",description:'"~"'},Fb=function(a){return ca(["escape",[a]])},Gb="*",Hb={type:"literal",value:"*",description:'"*"'},Ib="`",Jb={type:"literal",value:"`",description:'"`"'},Kb=function(a){return ca(["raw",[a.join("")]])},Lb="fn",Mb={type:"literal",value:"fn",description:'"fn"'},Nb=function(a){return a},Ob=function(a,b){return ca(["fn",[a,b]])},Pb="|",Qb={type:"literal",value:"|",description:'"|"'},Rb=function(a){return a},Sb=function(a,b){return ca(["pipe",[a,b]])},Tb=function(a,b){return ca(["call",[a,b]])},Ub=":",Vb={type:"literal",value:":",description:'":"'},Wb=function(a,b){return ca([a,b])},Xb=function(){return ca(["map",[]])},Yb=function(a){return ca(["map",[a]])},Zb=function(){return["array",[]]},$b=function(a){return ca(["array",[a]])},_b=function(){return ca(["empty",[]])},ac="==",bc={type:"literal",value:"==",description:'"=="'},cc=function(){return"eq"},dc="!=",ec={type:"literal",value:"!=",description:'"!="'},fc=function(){return"neq"},gc="<=",hc={type:"literal",value:"<=",description:'"<="'},ic=function(){return"lte"},jc=">=",kc={type:"literal",value:">=",description:'">="'},lc=function(){return"gte"},mc="<",nc={type:"literal",value:"<",description:'"<"'},oc=function(){return"lt"},pc=">",qc={type:"literal",value:">",description:'">"'},rc=function(){return"gt"},sc="and",tc={type:"literal",value:"and",description:'"and"'},uc=function(){return"cmpand"},vc="or",wc={type:"literal",value:"or",description:'"or"'},xc=function(){return"cmpor"},yc="not",zc={type:"literal",value:"not",description:'"not"'},Ac=function(){return"not"},Bc=function(a){return ca(["identifier",[null,a]])},Cc="+",Dc={type:"literal",value:"+",description:'"+"'},Ec=function(){return"add"},Fc=function(){return"sub"},Gc=function(){return"mul"},Hc="/",Ic={type:"literal",value:"/",description:'"/"'},Jc=function(){return"div"},Kc="%",Lc={type:"literal",value:"%",description:'"%"'},Mc=function(){return"mod"},Nc=0,Oc=0,Pc=[{line:1,column:1,seenCR:!1}],Qc=0,Rc=[],Sc=0;if("startRule"in ea){if(!(ea.startRule in ga))throw new Error("Can't start parsing from rule \""+ea.startRule+'".');ha=ga[ea.startRule]}if(da=ha(),da!==fa&&Nc===a.length)return da;throw da!==fa&&Nc<a.length&&f({type:"end",description:"end of input"}),g(null,Rc,Qc<a.length?a.charAt(Qc):null,Qc<a.length?e(Qc,Qc+1):e(Qc,Qc))}return a(b,Error),{SyntaxError:b,parse:c}}();return Lisplate.Parser=a,a}),function(a,b){"function"==typeof define&&define.amd?define("lisplate.compiler",["lisplate.core","lisplate.parser"],b):"object"==typeof exports?module.exports=b(require("./"),require("./parser")):b(a.Lisplate,a.Lisplate.Parser)}(this,function(Lisplate,a){"use strict";function b(){this.vars=[],this.defs={}}function c(){this.scopes=[]}function d(a,b,c,d){var e=a?a[2]:0,f=a?a[3]:0;return new i(b,c,d,{start:{offset:0,line:e,column:f},end:{offset:0,line:e,column:f}})}function e(a,b){return b&&b.length?"$c."+a+"("+b+")\n":""}function f(a){this.internalsUsed=[],this.symbolTable=new c,this.needLookup=[],this.setKeepWhitespace(a?a.keepWhitespace:void 0),this.setDefaultEscape(a?a.defaultEscape:void 0)}function g(b,c,d){var e=new f(d);try{var g=a.parse(c);if("block"!==g[0])throw new i("Expected template to start with a block, but found "+g[0]+" instead","block",g[0],{start:{offset:0,line:0,column:0},end:{offset:0,line:0,column:0}});var h=e.processblock(g[1],null,!1),j=e.outputInternals(),k=e.outputLookups(),l="function($$Lisplate,$$vmc){return function($data,$strings,$runtime,$ctx) {var $viewmodel = $$vmc ? new $$vmc($data,$strings,$ctx) : null;var $helper = $$Lisplate.helpers;var $_w = $runtime.Chunk;var $c = new $_w();\n"+j+k+h+"\nreturn $c.getOutput();\n}\n}";return l}catch(m){if(!m.location)throw m;var n=m.message+" ["+b+":"+m.location.start.line+":"+m.location.start.column+"]";throw new i(n,m.expected,m.found,m.location)}}function h(a,b,c){c||(c={});var d=g(a,b,c),e=c.wrapper;if(void 0===e&&(e="umd"),!e)return d;var f=m[e];if(!f)throw new Error("Wrapper type is not valid. Wrapper must be one of:"+Object.keys(m).join(", "));return f(a,d)}var i=a.SyntaxError,j={include:"processinclude"},k={def:"processdef",safe:"processsafe",pragma:"processpragma"},l={keepWhitespace:"setKeepWhitespace",defaultEscape:"setDefaultEscape"};b.prototype.addToScope=function(a,b){return this.vars.indexOf(a)===-1&&(this.vars.push(a),2===arguments.length&&(this.defs[a]=b),!0)},b.prototype.findInScope=function(a){return this.vars.indexOf(a)},c.prototype.pushScope=function(a){var c=new b;a&&a.length&&a.forEach(function(a){c.addToScope(a)}),this.scopes.push(c)},c.prototype.popScope=function(){var a=this.scopes.pop();return a.defs},c.prototype.addDefToScope=function(a,b){return this.scopes[this.scopes.length-1].addToScope(a,b)},c.prototype.findAddress=function(a){for(var b=this.scopes.length;b--;){var c=this.scopes[b],d=c.findInScope(a);if(d!==-1)return[b,d]}return null},f.prototype.setKeepWhitespace=function(a){this.keepWhitespace=a===!0},f.prototype.setDefaultEscape=function(a){var b=void 0!==a?a:"escapeHtml";if(b){var c=b.split("::");1===c.length&&(c=["",c[0]]),this.defaultEscape=this.processidentifier(c)[0]}else this.defaultEscape=null},f.prototype.processblock=function(a,b,c){var d=this,f="",g=a.length,h="";this.symbolTable.pushScope(b),a.forEach(function(b,i){var j=b[0];if(j)if("format"===j||"buffer"===j){h+="format"!==j||d.keepWhitespace?b[1]:"";var k=i+1;k<g&&("format"===a[k][0]||"buffer"===a[k][0])||h.length&&(f+=e("w",'"'+h.replace(/"/g,'\\"')+'"'),h="")}else{var l=d.processexp(b,c);f+=e("w",l)}else f+=""});var i=this.symbolTable.popScope(),j="";for(var k in i)j+="var "+k+" = "+i[k]+";\n";return j+f},f.prototype.processexp=function(a,b){var c=a[0];try{if("fn"===c)return this.processfn(a[1],b);if("pipe"===c)return this.processpipe(a[1],b);if("call"===c)return this.processcall(a[1],b);if("raw"===c)return this.processraw(a[1]);if("escape"===c)return this.processescape(a[1]);if("identifier"===c)return this.processidentifier(a[1])[0];if("literal"===c)return this.processliteral(a[1]);if("map"===c)return this.processmap(a[1],b);if("array"===c)return this.processarray(a[1],b);if("empty"===c)return this.processempty();throw d(null,"Expected to find an expression type but did not find one","type","null")}catch(e){throw d(a,e.message,e.expected,e.found)}},f.prototype.useinternal=function(a){return this.internalsUsed.indexOf(a)===-1&&this.internalsUsed.push(a),"$i_"+a},f.prototype.processidentifier=function(a){var b=a[0],c=a[1];if(b)return c?["$"+b+"."+c,!0]:["$"+b,!0];if(Lisplate.Runtime[c])return[this.useinternal(c),!1];var d=c.split("."),e=d[0];return this.symbolTable.findAddress(e)?[c,!0]:(this.needLookup.indexOf(e)===-1&&this.needLookup.push(e),["$lu_"+c,!0])},f.prototype.processliteral=function(a){return a[0]},f.prototype.processmap=function(a,b){var c=this,d=a[0],e="{";return d&&d.length&&(e+=d.map(function(a){return a[0]+":"+c.processexp(a[1],b)}).join(",")),e+="}"},f.prototype.processarray=function(a,b){var c=this,d=a[0],e="[";return d&&d.length&&(e+=d.map(function(a){return c.processexp(a,b)}).join(",")),e+="]"},f.prototype.processempty=function(){return"null"},f.prototype.processfn=function(a,b){var c=a[0],e=a[1],f="(function(";if(c&&c.length&&(f+=c.map(function(a){return a}).join(",")),f+=") {\nvar $c = new $_w();\n",!e||"block"!==e[0]||!e[1])throw d(null,"Expected function to contain a block","block",e?e[0]:"null");return f+=this.processblock(e[1],c,b),f+="\n return $c;\n})\n"},f.prototype.processinclude=function(a){if(!a||a.length<1||a.length>2)throw d(null,"Include must be called with 1 or 2 parameters: template-name and optional data","1 or 2 parameters, template-name and optional data",a?a.length:0);return a=a.slice(),1===a.length&&a.push(["empty"]),a.push(["identifier",["ctx",null]]),["$$Lisplate.renderTemplate",a,!1]},f.prototype.processdef=function(a,b){if(!a||2!==a.length)throw d(null,"def must be called with 2 parameters, the identifier to define and a value to bind to","2 parameters, identifier to define and value to use for binding",a?a.length:0);var c=a[0];if("identifier"!==c[0])throw d(null,"def first parameter must be an identifier to create and bind value to","identifier",c[0]);if(""!==c[1][0])throw d(null,"def first parameter must not be namespaced, cannot bind value to namespaced identifiers","non-namespaced identifier",c[1][0]+"::"+c[1][1]);var e=c[1][1],f=this.processexp(a[1],b);if(!this.symbolTable.addDefToScope(e,f))throw d(null,"identifier is already defined in the scope and cannot be redefined in the same scope","unused identifier or different scope for identifier",e);
return""},f.prototype.processsafe=function(a){if(!a||1!==a.length)throw d(null,"safe must be called with 1 parameter","1 parameter that will not be escaped",a?a.length:0);return this.processexp(a[0],!0)},f.prototype.processpragma=function(a){if(!a||2!==a.length)throw d(null,"pragma must be called with 2 parameters","2 parameters, identifier to options and literal",a?a.length:0);var b=a[0],c=a[1];if("identifier"!==b[0])throw d(null,"pragma first parameter must be a key for the option to set","identifier",b[0]);if(""!==b[1][0])throw d(null,"pragma first parameter must not be namespaced, no options are behind a namespaced","non-namespaced identifier",b[1][0]+"::"+b[1][1]);if("literal"!==c[0])throw d(null,"pragma second parameter must be a literal to st the option to","literal",c[0]);var e=b[1][1],f=c[1][0];'"'===f[0]&&'"'===f[f.length-1]&&(f=f.substring(1,f.length-1));var g=l[e];if(!g)throw d(null,"invalid pragma","valid pragma: "+Object.keys(l).join(", "),e);return this[g](f),""},f.prototype.processpipe=function(a,b){function c(a){var c=a[0];if("fn"===c)return e.processfn(a[1],b);if("identifier"===c){var g=e.processidentifier(a[1]);return f=f||g[1],g[0]}throw d(null,"Unknown callable","fn or identifier",c)}var e=this,f=!1,g=a[0],h=a[1],i=null;if("literal"===g[0])i=this.processliteral(g[1]);else if("map"===g[0])i=this.processmap(g[1],b);else if("array"===g[0])i=this.processarray(g[1],b);else{var j=c(g);i="(typeof "+j+" === 'function' ? "+j+"() : "+j+")"}for(;h.length;){var k=h.shift(),l=c(k);i=l+"("+i+")"}return i},f.prototype.processcall=function(a,b){var c=this,e=!0,f=b,g=null,h=a[0],i=a[1],l=h[0];if("fn"===l)e=!1,g=c.processfn(h[1],b);else{if("identifier"!==l)throw d(null,"Unknown callable","fn, identifier, or internal",l);if(""===h[1][0])if(g=h[1][1],j[g]){var m=this[j[g]](i,b);g=m[0],i=m[1],e=m[2]}else{if(k[g])return this[k[g]](i,b);g=null}if(!g){var n=c.processidentifier(h[1]);g=n[0],e=n[1]}}e=e&&b!==!0;var o=g;return i&&i.length?(o+="(",o+=i.map(function(a){return c.processexp(a,f)}).join(","),o+=")"):o="(typeof "+o+" === 'function' ? "+o+"() : "+o+")",e&&this.defaultEscape&&(o=this.defaultEscape+"("+o+")"),o},f.prototype.processraw=function(a){return'"'+a[0]+'"'},f.prototype.processescape=function(a){var b=a[0];if("s"===b)return'" "';if("n"===b)return'"\\n"';if("r"===b)return'"\\r"';if("lb"===b)return'"{"';if("rb"===b)return'"}"';throw new Error("Unknown escape: "+b)},f.prototype.outputInternals=function(){return this.internalsUsed.length?"var "+this.internalsUsed.map(function(a){return"$i_"+a+" = $runtime."+a}).join(",\n")+";\n\n":""},f.prototype.outputLookups=function(){if(!this.needLookup.length)return"";var a="function $_lookup(key) {\n  var searches = [$viewmodel, $data, $helper, $strings, $ctx];\n  for (var i=0; i < searches.length; i++) {\n    var s = searches[i];\n    if (s && s[key]) {\n      return s[key];\n    }\n  }\n  return null;\n};\n";return a+"var "+this.needLookup.map(function(a){return"$lu_"+a+" = $_lookup('"+a+"')"}).join(",\n")+";\n\n"};var m={umd:function(a,b){return"(function(root, factory) {\nif (typeof define === 'function' && define.amd) {\ndefine('"+a+"', [], factory);\n} else if (typeof exports === 'object') {\nmodule.exports = factory();\n} else {\nroot['"+a+"'] = factory();\n}\n}(this, function() {\n'use strict';\nvar fn = "+b+"\nreturn {\ntemplateName: '"+a+"',\nrenderFactory: fn\n};\n}));\n"},amd:function(a,b){return"define('"+a+"', [], function() {'use strict';\nvar fn = "+b+"\nreturn {\ntemplateName: '"+a+"',\nrenderFactory: fn\n};\n});\n"},commonjs:function(a,b){return"'use strict';\nvar fn = "+b+"\nmodule.exports = {\ntemplateName: '"+a+"',\nrenderFactory: fn\n};\n"},es6:function(a,b){return"const fn = "+b+"\nexport default {\ntemplateName: '"+a+"',\nrenderFactory: fn\n};\n"}};return Lisplate.Compiler={compile:g,compileModule:h},Lisplate.Compiler});
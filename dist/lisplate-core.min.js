/*! lisplate - v0.4.2
* https://github.com/HallM/lisplate
* Copyright (c) 2016 ; Released under the MIT License */
!function(a,b){"function"==typeof define&&define.amd?define("lisplate.utils",[],b):"object"==typeof exports?module.exports=b():(a.Lisplate={},a.Lisplate.Utils=b())}(this,function(){"use strict";return{loadCompiledSource:function loadCompiledSource(compiledSource){var template=null;return eval("template="+compiledSource),template},resolve:function(a){return"function"==typeof a?a():a},thenable:function(a){return("object"==typeof a||"function"==typeof a)&&"function"==typeof a.then}}}),function(a,b){"function"==typeof define&&define.amd?define("lisplate.runtime",["lisplate.utils"],b):"object"==typeof exports?module.exports=b(require("./util")):a.Lisplate.Runtime=b(a.Lisplate.Utils)}(this,function(a){"use strict";function b(a){return j[a]}function c(a){return m[a]}function d(a){return p[a]}function e(){this.current="",this.stack=[],this.lastFlushedIndex=0,this.thenables=[],this.isAsync=!1,this.lastWasAsync=!1}var f=a.resolve,g=a.thenable,h=/[&<>\"\']/,i=/[&<>\"\']/g,j={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"},k=/[\\\/\r\n\f\t'"\u2028\u2029]/,l=/[\\\/\r\n\f\t'"\u2028\u2029]/g,m={"\\":"\\\\","/":"\\/","\r":"\\r","\n":"\\n","\f":"\\f","\t":"\\t","'":"\\'",'"':'\\"',"\u2028":"\\u2028","\u2029":"\\u2029"},n=/["<\u2028\u2029]/,o=/["<\u2028\u2029]/g,p={'"':'\\"',"<":"\\u003c","\u2028":"\\u2029","\u2029":"\\u2029"},q={escapeHtml:function(a){return"string"!=typeof a?a:h.test(a)?a.replace(i,b):a},escapeJs:function(a){return"string"!=typeof a?a:k.test(a)?a.replace(l,c):a},escapeJson:function(a){return"string"!=typeof a?a:n.test(a)?a.replace(o,d):a},not:function(a){return!f(a)},eq:function(a,b){return f(a)===f(b)},neq:function(a,b){return f(a)!==f(b)},lt:function(a,b){return f(a)<f(b)},gt:function(a,b){return f(a)>f(b)},lte:function(a,b){return f(a)<=f(b)},gte:function(a,b){return f(a)>=f(b)},cmpand:function(a,b){return f(a)&&f(b)},cmpor:function(a,b){return f(a)||f(b)},add:function(a,b){return f(a)+f(b)},sub:function(a,b){return f(a)-f(b)},mul:function(a,b){return f(a)*f(b)},div:function(a,b){return f(a)/f(b)},mod:function(a,b){return f(a)%f(b)},safe:function(a){var b=new e;return b.w(a),b},each:function(a,b,c){var d=f(a);if(g(d))return d.then(function(a){return q.each(a,b,c)});var h=0;if(d&&(h=d.length)){if(b){for(var i=new e,j=0;j<h;j++)"function"==typeof b?i.w(b(d[j],j)):i.w(b);return i.getOutput()}}else if(c)return f(c);return""},"if":function(a,b,c){var d=f(a);if(g(d))return d.then(function(a){return q["if"](a,b,c)});if(d){if(b)return f(b)}else if(c)return f(c);return""},isEmpty:function(a){var b=f(a);return 0!==b&&(!(!Array.isArray(b)||b.length)||!b)},isNotEmpty:function(a){return!q.isEmpty(a)}};return e.prototype.w=function(a){var b=f(a);if(null!=b)if(b instanceof e&&(b=b.getOutput()),g(b)){this.current.length&&(this.stack.push(this.current),this.current=""),this.isAsync=!0,this.lastWasAsync=!0;var c=this.stack.length;this.stack.push("");var d=this,h=b.then(function(a){d.stack[c]=a});this.thenables.push(h)}else this.lastWasAsync?this.current=b:this.current+=b,this.lastWasAsync=!1},e.prototype.getOutput=function(){var a=this;return a.isAsync?(a.current.length&&a.stack.push(a.current),Promise.all(a.thenables).then(function(){return a.stack.join("")})):a.current},q.Chunk=e,q}),function(a,b){"function"==typeof define&&define.amd?define("lisplate.core",["lisplate.runtime","lisplate.utils"],b):"object"==typeof exports?module.exports=b(require("./runtime"),require("./util")):a.Lisplate=b(a.Lisplate.Runtime,a.Lisplate.Utils)}(this,function(a,b){"use strict";function c(a){var b=a.length;return function(){var c=arguments.length,d=c>b?arguments[c-1]:null,f=null;"function"==typeof d?f=Array.prototype.slice.call(arguments,0,c-1):(f=Array.prototype.slice.call(arguments,0,c),d=null);var g=a.apply(this,f);return e(g)?d?void g.then(function(a){d(null,a)})["catch"](function(a){d(a)}):g:d?void d(null,g):g}}function d(a){var b=a.length;return function(){var c=Array.prototype.slice.apply(arguments),d=c.length;return b===d+1?new Promise(function(b,d){c.push(function(a,c){return a?void d(a):void b(c)}),a.apply(null,c)}):Promise.resolve(a.apply(null,c))}}function Lisplate(a){a||(a={}),this.cacheEnabled=!(a.cacheEnabled===!1),this.sourceLoader=a.sourceLoader,this.viewModelLoader=a.viewModelLoader,this.stringsLoader=a.stringsLoader,this.helpers={},this.cache={}}var e=b.thenable;return Lisplate.Runtime=a,Lisplate.Utils=b,Lisplate.prototype.addHelper=function(a,b){this.helpers[a]=b},Lisplate.prototype.loadTemplate=c(function(a){var b=this;if(!a)return Promise.reject(new Error("Must specify template information to load"));var c="string"==typeof a?a:a.templateName,e=a.renderFactory;if(""===c)return Promise.reject(new Error("Must specify a valid template name to load"));if(e)e=Promise.resolve(e);else{if(b.cache[c])return Promise.resolve(b.cache[c]);if(!b.sourceLoader)return Promise.reject(new Error("Must define a sourceLoader"));if(!Lisplate.Compiler||!Lisplate.Compiler.compile)return Promise.reject("Compiler is not loaded to compile loaded source");e=d(b.sourceLoader)(c).then(function(a){var b=null,d=null;try{b=Lisplate.Compiler.compile(c,a),d=Lisplate.Utils.loadCompiledSource(b)}catch(e){return Promise.reject(e)}return Promise.resolve(d)})}return e.then(function(a){var e=null;return e=b.viewModelLoader?d(b.viewModelLoader)(c):Promise.resolve(null),e.then(function(d){var e=a(b,d);return e.templateName=c,b.cache[c]=e,e})})}),Lisplate.prototype.render=c(function(a,b){var c=this;return c.stringsLoader?d(c.stringsLoader)(a.templateName).then(function(c){return a(b,c,Lisplate.Runtime)}):a(b,null,Lisplate.Runtime)}),Lisplate.prototype.renderTemplate=c(function(a,b){var c=this;return c.loadTemplate(a).then(function(a){return c.render(a,b)})}),Lisplate});